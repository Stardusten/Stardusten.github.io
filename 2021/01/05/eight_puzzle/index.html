<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","version":"8.2.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}};
  </script>
<meta name="description" content="算法实现Github 项目地址 Test.in121 2 3 4 5 6 7 8 08 7 6 5 4 3 2 1 0 BFS.cpp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071">
<meta property="og:type" content="article">
<meta property="og:title" content="八数码">
<meta property="og:url" content="http://example.com/2021/01/05/eight_puzzle/index.html">
<meta property="og:site_name" content="Stardust&#39;s Cabin">
<meta property="og:description" content="算法实现Github 项目地址 Test.in121 2 3 4 5 6 7 8 08 7 6 5 4 3 2 1 0 BFS.cpp1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071">
<meta property="og:locale">
<meta property="article:published_time" content="2021-01-05T03:04:29.000Z">
<meta property="article:modified_time" content="2021-01-05T03:43:07.770Z">
<meta property="article:author" content="Stardust Crusader">
<meta property="article:tag" content="算法">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2021/01/05/eight_puzzle/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.js"></script>
<title>八数码 | Stardust's Cabin</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-84HT6HN7R4"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-84HT6HN7R4');
      }
    </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Stardust's Cabin</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">博观而约取，厚积而薄发</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Contents
        </li>
        <li class="sidebar-nav-overview">
          About
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%97%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.</span> <span class="nav-text">算法实现</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GUI-%E9%83%A8%E5%88%86%E4%BB%A3%E7%A0%81"><span class="nav-number">2.</span> <span class="nav-text">GUI 部分代码</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Stardust Crusader"
      src="https://cdn.jsdelivr.net/gh/Stardusten/Pic@master/uPic/38722307.jpeg">
  <p class="site-author-name" itemprop="name">Stardust Crusader</p>
  <div class="site-description" itemprop="description">Technique & Life</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Stardusten" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Stardusten" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/xiangbaobao2003@gmail.com" title="E-Mail → xiangbaobao2003@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/05/eight_puzzle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/Stardusten/Pic@master/uPic/38722307.jpeg">
      <meta itemprop="name" content="Stardust Crusader">
      <meta itemprop="description" content="Technique & Life">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Stardust's Cabin">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          八数码
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-01-05 11:04:29 / 修改时间：11:43:07" itemprop="dateCreated datePublished" datetime="2021-01-05T11:04:29+08:00">2021-01-05</time>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>102k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1:33</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h2><p><a target="_blank" rel="noopener" href="https://github.com/Stardusten/8_puzzle_algo">Github 项目地址</a></p>
<figure class="highlight txt"><figcaption><span>Test.in</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 2 3 4 5 6 7 8 0</span><br><span class="line">8 7 6 5 4 3 2 1 0</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>BFS.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. BFS</span></span><br><span class="line"><span class="comment">         2. Bitmap</span></span><br><span class="line"><span class="comment">         3. Use Cantor expansion to encode</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Preprocess factor range 0~9 for Cantor expansion</span></span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use Cantor expansion to encode all the permutations of 123456780 to integer range 0~9!</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)</span><br><span class="line">            <span class="keyword">if</span>(p[j]&lt;p[i])  cnt++;</span><br><span class="line">        code+=fact[<span class="number">8</span>-i]*cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ceil function for bitmap constructor</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bitmap as Closed list</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap(): buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    bitmap(<span class="keyword">int</span> siz)&#123;</span><br><span class="line">        buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(siz/<span class="number">32</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    ~bitmap()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] buf;</span><br><span class="line">        buf=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    <span class="keyword">int</span> fa; <span class="comment">// Save father state idx for each state to print the path</span></span><br><span class="line">    <span class="keyword">int</span> steps; <span class="comment">// steps to reach current state</span></span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use queue as Open list</span></span><br><span class="line"><span class="comment">// To save all the states, we use STL vector to simulate queue</span></span><br><span class="line"><span class="built_in">vector</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bitmap as Closed list</span></span><br><span class="line"><span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123; <span class="comment">// Recursive print path</span></span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">-1</span>) <span class="keyword">return</span>; <span class="comment">// Reach ini state, return</span></span><br><span class="line">    print(q[n].fa);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;q[n].s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Initialize factor[]</span></span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">// 0!=1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    ini.fa=<span class="number">-1</span>; <span class="comment">// Recursive termination condition</span></span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    q.push_back(ini); <span class="comment">// Push ini state into the Open list</span></span><br><span class="line">    <span class="keyword">int</span> front=<span class="number">0</span>, rear=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(front&lt;rear)&#123; <span class="comment">// Loop until queue is empty</span></span><br><span class="line">        state &amp; cur=q[front];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123; <span class="comment">// Find!</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;cur.steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            print(front);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.fa=front;</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">// Encode new state</span></span><br><span class="line">                <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123; <span class="comment">// If the new state is unvisited</span></span><br><span class="line">                    vis.visit(code); <span class="comment">// Mark it as visited</span></span><br><span class="line">                    q.push_back(next); <span class="comment">// Add it to the Open list</span></span><br><span class="line">                    rear++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        front++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) bfs();</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n is in the j-th bit of the i-th int</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">    |  1st int |  2nd int |  3rd int |          | i-th int |</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">                                                       ↑</span></span><br><span class="line"><span class="comment">                                                    j-th bit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>; <span class="comment">// Equivalent to j=n%32;</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To change the j-th bit from 0 to 1,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th bit is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then OR the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010</span></span><br><span class="line"><span class="comment">            OR  1100 0010</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bitmap::is_visited</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To check the j-th bit,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then AND the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000			        1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010			        0100 0000</span></span><br><span class="line"><span class="comment">           AND  0000 0000 (false)      AND  0100 0000 (true)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>BFS_2.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. BFS</span></span><br><span class="line"><span class="comment">         2. Bitmap</span></span><br><span class="line"><span class="comment">         3. Use bit operation to encode</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">    <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">    <span class="keyword">int</span> f;</span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> state &amp; x, <span class="keyword">const</span> state &amp; y)&#123; <span class="comment">// Reload operator &lt; for priority_queue</span></span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Preprocess factor range 0~9 for Cantor expansion</span></span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use Cantor expansion to encode all the permutations of 123456780 to integer range 0~9!</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        code|=((<span class="keyword">long</span>)p[i]&lt;&lt;(i&lt;&lt;<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ceil function for bitmap constructor</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bitmap as Closed list</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap(): buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    bitmap(T siz)&#123;</span><br><span class="line">        buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(siz/<span class="number">32</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    ~bitmap()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] buf;</span><br><span class="line">        buf=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(T)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(T)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">bitmap&lt;<span class="keyword">long</span>&gt; <span class="title">vis</span><span class="params">(<span class="number">36344967696</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use queue as Open list</span></span><br><span class="line"><span class="comment">// To save all the states, we use STL vector to simulate queue</span></span><br><span class="line"><span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_misplaced</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(cur.s[i]!=goal.s[i]) num++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Initialize factor[]</span></span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">// 0!=1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    <span class="comment">// Initialize ini state</span></span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    ini.h=calc_misplaced(ini,goal);</span><br><span class="line">    ini.f=ini.steps+ini.h;</span><br><span class="line">    q.push(ini);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        state cur=q.top();</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span>(!cur.h)&#123; <span class="comment">// Find!</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;cur.steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                next.h=calc_misplaced(next,goal);</span><br><span class="line">                next.f=next.steps+next.h;</span><br><span class="line">                <span class="keyword">long</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                    vis.visit(code);</span><br><span class="line">                    q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) bfs();</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> bitmap&lt;T&gt;::visit(T n)&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n is in the j-th bit of the i-th int</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">    |  1st int |  2nd int |  3rd int |          | i-th int |</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">                                                       ↑</span></span><br><span class="line"><span class="comment">                                                    j-th bit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>; <span class="comment">// Equivalent to j=n%32;</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To change the j-th bit from 0 to 1,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th bit is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then OR the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010</span></span><br><span class="line"><span class="comment">            OR  1100 0010</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> bitmap&lt;T&gt;::is_visited(T n)&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To check the j-th bit,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then AND the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000			        1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010			        0100 0000</span></span><br><span class="line"><span class="comment">           AND  0000 0000 (false)      AND  0100 0000 (true)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>DFS.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Depth First Search</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;csetjmp&gt;</span></span></span><br><span class="line"><span class="keyword">static</span> jmp_buf buf;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span>)</span></span>; <span class="comment">// 向上取整</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>&amp;,<span class="keyword">int</span>&amp;)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span>* p)</span></span>; <span class="comment">// 康拓展开</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span> <span class="comment">// 位图</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap();</span><br><span class="line">    bitmap(<span class="keyword">int</span>);</span><br><span class="line">    ~bitmap();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">undo_visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MAXS=<span class="number">1000</span>;</span><br><span class="line"><span class="comment">// 四种移动方式</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[]=&#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">9</span>]; <span class="comment">// 预处理 0~9 的阶乘</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> state[<span class="number">9</span>]; <span class="comment">// 定义状态</span></span><br><span class="line">state st[MAXS]; <span class="comment">// 所有状态记录在 st 中</span></span><br><span class="line"><span class="keyword">int</span> dist[MAXS]; <span class="comment">// 记录初始状态到每个状态的距离</span></span><br><span class="line"><span class="keyword">int</span> goal[<span class="number">9</span>]; <span class="comment">// 目标状态</span></span><br><span class="line"><span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> d)</span></span>&#123;</span><br><span class="line">    <span class="comment">// if(d&gt;4) return;</span></span><br><span class="line">    state&amp; cur=st[d];</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">memcmp</span>(goal,cur,<span class="keyword">sizeof</span>(goal))==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;d&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;=d;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;st[i][j]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        longjmp(buf,<span class="number">0</span>); <span class="comment">// longjmp 实现全局跳转</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> p0;</span><br><span class="line">    <span class="keyword">for</span>(p0=<span class="number">0</span>;p0&lt;<span class="number">9</span>;p0++) <span class="keyword">if</span>(!cur[p0]) <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">int</span> x=p0/<span class="number">3</span>,y=p0%<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// 尝试上、下、左、右移动空格</span></span><br><span class="line">        <span class="keyword">int</span> new_x=x+dx[i];</span><br><span class="line">        <span class="keyword">int</span> new_y=y+dy[i];</span><br><span class="line">        <span class="keyword">int</span> new_p0=new_x*<span class="number">3</span>+new_y;</span><br><span class="line">        <span class="keyword">if</span>(new_x&gt;=<span class="number">0</span> &amp;&amp; new_x&lt;<span class="number">3</span> &amp;&amp; new_y&gt;=<span class="number">0</span> &amp;&amp; new_y&lt;<span class="number">3</span>)&#123;</span><br><span class="line">            state&amp; t=st[d+<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">memcpy</span>(&amp;t,&amp;cur,<span class="keyword">sizeof</span>(cur));</span><br><span class="line">            swap(t[new_p0],t[p0]);</span><br><span class="line">            <span class="keyword">int</span> code=encode(t);</span><br><span class="line">            <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                vis.visit(code);</span><br><span class="line">                dfs(d+<span class="number">1</span>);</span><br><span class="line">                vis.undo_visit(code);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;st[<span class="number">0</span>][i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;goal[i];</span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">// 0!=1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    <span class="comment">//int a[9]=&#123;1,2,3,4,0,6,7,5,8&#125;;</span></span><br><span class="line">    <span class="comment">//std::cout&lt;&lt;encode(a);</span></span><br><span class="line">    vis.visit(encode(st[<span class="number">0</span>]));</span><br><span class="line">    <span class="keyword">int</span> r=setjmp(buf);</span><br><span class="line">    <span class="keyword">if</span>(!r) dfs(<span class="number">0</span>);</span><br><span class="line">    <span class="comment">//std::cout&lt;&lt;dist[ans];</span></span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>&amp; x,<span class="keyword">int</span>&amp; y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp=x;</span><br><span class="line">    x=y;</span><br><span class="line">    y=tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)</span><br><span class="line">            <span class="keyword">if</span>(p[j]&lt;p[i])  cnt++;</span><br><span class="line">        code+=fact[<span class="number">8</span>-i]*cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line">bitmap::bitmap():buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">bitmap::bitmap(<span class="keyword">int</span> upper_bound)&#123;</span><br><span class="line">    buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(upper_bound/<span class="number">32</span>)];</span><br><span class="line">&#125;</span><br><span class="line">bitmap::~bitmap()&#123;</span><br><span class="line">    <span class="keyword">delete</span> [] buf;</span><br><span class="line">    buf=<span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">// n 对应的 bit 为第 i 个 int 的第 j 位</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="comment">// a%b==a&amp;(b-1) b 为 2 的幂</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::undo_visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    buf[i]|=~(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bitmap::is_visited</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>IDDFS.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. IDDFS</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max_depth=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="built_in">stack</span>&lt;state&gt; st; <span class="comment">// Save states to print path</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDDFS</span><span class="params">(state &amp; cur, <span class="keyword">const</span> <span class="keyword">int</span> &amp; steps, <span class="keyword">const</span> <span class="keyword">int</span> &amp; prepos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123; <span class="comment">// Find!</span></span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        st.push(cur);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Set return flag</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Reach max_f and no solution was found</span></span><br><span class="line">    <span class="comment">// Return recursively and search with bigger max_f later</span></span><br><span class="line">    <span class="keyword">if</span>(steps&gt;max_depth) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">        <span class="comment">// If the next state is the same as the previous state,</span></span><br><span class="line">        <span class="comment">// there is a loop, so we need to skip this state</span></span><br><span class="line">        <span class="comment">// We choose to compare the position of 0 between the two states instead of using memcmp,</span></span><br><span class="line">        <span class="comment">// because you cannot move 0 back and move another block at the same time</span></span><br><span class="line">        <span class="keyword">if</span>(d[cur.pos][i]==prepos) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(~d[cur.pos][i])&#123;  <span class="comment">// If current move is accepted</span></span><br><span class="line">            <span class="comment">// Construct the new state after move</span></span><br><span class="line">            state next;</span><br><span class="line">            <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">            next.pos=d[cur.pos][i];</span><br><span class="line">            swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">            <span class="keyword">if</span>(IDDFS(next, steps+<span class="number">1</span>, cur.pos))&#123;</span><br><span class="line">                st.push(cur);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Return recursively</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!st.empty())&#123;</span><br><span class="line">        state &amp; tmp=st.top();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;tmp.s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        st.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="comment">// Increase max_f iteratively until a solution was found</span></span><br><span class="line">        <span class="keyword">while</span>(!IDDFS(ini,<span class="number">0</span>,<span class="number">-1</span>)) max_depth++;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    print();</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>IDA*_manhattan.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. IDA*</span></span><br><span class="line"><span class="comment">         2. Manhattan</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> max_f; <span class="comment">// Maximun search f value</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="built_in">stack</span>&lt;state&gt; st; <span class="comment">// Save states to print path</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess manhattan[pos_1][pos_2] = manhattan distance between block 1 and block 2</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>]=&#123;</span><br><span class="line">        <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDA_star</span><span class="params">(state &amp; cur, <span class="keyword">const</span> <span class="keyword">int</span> &amp; steps, <span class="keyword">const</span> <span class="keyword">int</span> &amp; h, <span class="keyword">const</span> <span class="keyword">int</span> &amp; prepos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123; <span class="comment">// Find!</span></span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        st.push(cur);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Set return flag</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Reach max_f and no solution was found</span></span><br><span class="line">    <span class="comment">// Return recursively and search with bigger max_f later</span></span><br><span class="line">    <span class="keyword">if</span>(steps+h&gt;max_f) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">        <span class="comment">// If the next state is the same as the previous state,</span></span><br><span class="line">        <span class="comment">// there is a loop, so we need to skip this state</span></span><br><span class="line">        <span class="comment">// We choose to compare the position of 0 in the two states instead of using memcmp,</span></span><br><span class="line">        <span class="comment">// because you cannot move 0 back and move another block at the same time</span></span><br><span class="line">        <span class="keyword">if</span>(d[cur.pos][i]==prepos) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(~d[cur.pos][i])&#123;  <span class="comment">// If current move is accepted</span></span><br><span class="line">            <span class="comment">// Construct the new state after move</span></span><br><span class="line">            state next;</span><br><span class="line">            <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">            next.pos=d[cur.pos][i];</span><br><span class="line">            swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">            <span class="keyword">if</span>(IDA_star(next, steps+<span class="number">1</span>, calc_manhattan(next,goal), cur.pos))&#123;</span><br><span class="line">                st.push(cur);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Return recursively</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(!st.empty())&#123;</span><br><span class="line">        state &amp; tmp=st.top();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;tmp.s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        st.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    max_f=calc_manhattan(ini,goal);</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="comment">// Increase max_f iteratively until a solution was found</span></span><br><span class="line">        <span class="keyword">while</span>(!IDA_star(ini,<span class="number">0</span>,max_f,<span class="number">-1</span>)) max_f++;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    print();</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>A*_manhattan.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. A*</span></span><br><span class="line"><span class="comment">         2. Manhattan</span></span><br><span class="line"><span class="comment">         3. Bitmap</span></span><br><span class="line"><span class="comment">         4. Use Cantor expansion to encode</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">    <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">    <span class="keyword">int</span> f;</span><br><span class="line">    <span class="keyword">int</span> fa;</span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> state &amp; x, <span class="keyword">const</span> state &amp; y)&#123; <span class="comment">// Reload operator &lt; for priority_queue</span></span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use vector to save all the states</span></span><br><span class="line"><span class="built_in">vector</span>&lt;state&gt; v;</span><br><span class="line"><span class="keyword">int</span> v_end=<span class="number">-1</span>; <span class="comment">// End index</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Preprocess factor range 0~9 for Cantor expansion</span></span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use Cantor expansion to encode all the permutations of 123456780 to integer range 0~9!</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)</span><br><span class="line">            <span class="keyword">if</span>(p[j]&lt;p[i])  cnt++;</span><br><span class="line">        code+=fact[<span class="number">8</span>-i]*cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ceil function for bitmap constructor</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bitmap as Closed list</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap(): buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    bitmap(<span class="keyword">int</span> siz)&#123;</span><br><span class="line">        buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(siz/<span class="number">32</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    ~bitmap()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] buf;</span><br><span class="line">        buf=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use queue as Open list</span></span><br><span class="line"><span class="comment">// To save all the states, we use STL vector to simulate queue</span></span><br><span class="line"><span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess manhattan[pos_1][pos_2] = manhattan distance between block 1 and block 2</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>]=&#123;</span><br><span class="line">        <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; fa)</span></span>&#123; <span class="comment">// Print path recursively</span></span><br><span class="line">    <span class="keyword">if</span>(fa==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">    print(v[fa].fa);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;v[fa].s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Initialize factor[]</span></span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">// 0!=1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    <span class="comment">// Initialize ini state</span></span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    ini.h=calc_manhattan(ini,goal);</span><br><span class="line">    ini.f=ini.steps+ini.h;</span><br><span class="line">    ini.fa=<span class="number">-1</span>;</span><br><span class="line">    q.push(ini);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        state cur=q.top();</span><br><span class="line">        v.push_back(cur);</span><br><span class="line">        v_end++;</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span>(!cur.h)&#123; <span class="comment">// Find!</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;cur.steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            print(v_end);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                next.h=calc_manhattan(next,goal);</span><br><span class="line">                next.f=next.steps+next.h;</span><br><span class="line">                next.fa=v_end;</span><br><span class="line">                <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                    vis.visit(code);</span><br><span class="line">                    q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) bfs();</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n is in the j-th bit of the i-th int</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">    |  1st int |  2nd int |  3rd int |          | i-th int |</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">                                                       ↑</span></span><br><span class="line"><span class="comment">                                                    j-th bit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>; <span class="comment">// Equivalent to j=n%32;</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To change the j-th bit from 0 to 1,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th bit is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then OR the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010</span></span><br><span class="line"><span class="comment">            OR  1100 0010</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bitmap::is_visited</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To check the j-th bit,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then AND the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000			        1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010			        0100 0000</span></span><br><span class="line"><span class="comment">           AND  0000 0000 (false)      AND  0100 0000 (true)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>A*_manhattan_2.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. A*</span></span><br><span class="line"><span class="comment">         2. Manhattan</span></span><br><span class="line"><span class="comment">         3. Bitmap</span></span><br><span class="line"><span class="comment">         4. Use bit operation to encode</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">    <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">    <span class="keyword">int</span> f;</span><br><span class="line">    <span class="keyword">int</span> fa;</span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> state &amp; x, <span class="keyword">const</span> state &amp; y)&#123; <span class="comment">// Reload operator &lt; for priority_queue</span></span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use vector to save all the states</span></span><br><span class="line"><span class="built_in">vector</span>&lt;state&gt; v;</span><br><span class="line"><span class="keyword">int</span> v_end=<span class="number">-1</span>; <span class="comment">// End index</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Preprocess factor range 0~9 for Cantor expansion</span></span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bit operation to encode all the permutations of 123456780 to long integer</span></span><br><span class="line"><span class="comment">// Store an integer range 0(0000)~8(1000) every 4 bits</span></span><br><span class="line"><span class="comment">// So the min_code = 305419896 (represents 0,1,2,3,4,5,6,7,8)</span></span><br><span class="line"><span class="comment">//        max_code = 36344967696 (represents 8,7,6,5,4,3,2,1,0)</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        code|=((<span class="keyword">long</span>)p[i]&lt;&lt;(i&lt;&lt;<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ceil function for bitmap constructor</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bitmap as Closed list</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap(): buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    bitmap(T siz)&#123;</span><br><span class="line">        buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(siz/<span class="number">32</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    ~bitmap()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] buf;</span><br><span class="line">        buf=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(T)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(T)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">bitmap&lt;<span class="keyword">long</span>&gt; <span class="title">vis</span><span class="params">(<span class="number">36344967696</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use queue as Open list</span></span><br><span class="line"><span class="comment">// To save all the states, we use STL vector to simulate queue</span></span><br><span class="line"><span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess manhattan[pos_1][pos_2] = manhattan distance between block 1 and block 2</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>]=&#123;</span><br><span class="line">        <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; fa)</span></span>&#123; <span class="comment">// Print path recursively</span></span><br><span class="line">    <span class="keyword">if</span>(fa==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">    print(v[fa].fa);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;v[fa].s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Initialize factor[]</span></span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">// 0!=1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    <span class="comment">// Initialize ini state</span></span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    ini.h=calc_manhattan(ini,goal);</span><br><span class="line">    ini.f=ini.steps+ini.h;</span><br><span class="line">    ini.fa=<span class="number">-1</span>;</span><br><span class="line">    q.push(ini);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        state cur=q.top();</span><br><span class="line">        v.push_back(cur);</span><br><span class="line">        v_end++;</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span>(!cur.h)&#123; <span class="comment">// Find!</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;cur.steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            print(v_end);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                next.h=calc_manhattan(next,goal);</span><br><span class="line">                next.f=next.steps+next.h;</span><br><span class="line">                next.fa=v_end;</span><br><span class="line">                <span class="keyword">long</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                    vis.visit(code);</span><br><span class="line">                    q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) bfs();</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> bitmap&lt;T&gt;::visit(T n)&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n is in the j-th bit of the i-th int</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">    |  1st int |  2nd int |  3rd int |          | i-th int |</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">                                                       ↑</span></span><br><span class="line"><span class="comment">                                                    j-th bit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>; <span class="comment">// Equivalent to j=n%32;</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To change the j-th bit from 0 to 1,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th bit is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then OR the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010</span></span><br><span class="line"><span class="comment">            OR  1100 0010</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> bitmap&lt;T&gt;::is_visited(T n)&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To check the j-th bit,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then AND the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000			        1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010			        0100 0000</span></span><br><span class="line"><span class="comment">           AND  0000 0000 (false)      AND  0100 0000 (true)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>A*_manhattan_3.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// by Stardust 2020.12.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Tags: 1. A*</span></span><br><span class="line"><span class="comment">         2. Misplaced number</span></span><br><span class="line"><span class="comment">         3. Bitmap</span></span><br><span class="line"><span class="comment">         4. Use bit operation to encode</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preprocess d[pos_0][move_direction]=new_pos_0</span></span><br><span class="line"><span class="comment">// move_direction: 0-Up, 1-Down, 2-Left, 3-Right</span></span><br><span class="line"><span class="comment">// val: -1-illegal move, 0~8: new_pos_0</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>]=&#123;</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">3</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">4</span>,<span class="number">0</span>,<span class="number">2</span>&#125;,</span><br><span class="line">        &#123;<span class="number">-1</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0</span>,<span class="number">6</span>,<span class="number">-1</span>,<span class="number">4</span>&#125;,</span><br><span class="line">        &#123;<span class="number">1</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">5</span>&#125;,</span><br><span class="line">        &#123;<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">-1</span>&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">7</span>&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>,<span class="number">-1</span>,<span class="number">6</span>,<span class="number">8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>,<span class="number">-1</span>,<span class="number">7</span>,<span class="number">-1</span>&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// State structure</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">    <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">    <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">    <span class="keyword">int</span> f;</span><br><span class="line">    <span class="keyword">int</span> fa;</span><br><span class="line">&#125;ini,goal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> state &amp; x, <span class="keyword">const</span> state &amp; y)&#123; <span class="comment">// Reload operator &lt; for priority_queue</span></span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use vector to save all the states</span></span><br><span class="line"><span class="built_in">vector</span>&lt;state&gt; v;</span><br><span class="line"><span class="keyword">int</span> v_end=<span class="number">-1</span>; <span class="comment">// End index</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Preprocess factor range 0~9 for Cantor expansion</span></span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use Cantor expansion to encode all the permutations of 123456780 to integer range 0~9!</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        code|=((<span class="keyword">long</span>)p[i]&lt;&lt;(i&lt;&lt;<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Ceil function for bitmap constructor</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use bitmap as Closed list</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap(): buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    bitmap(T siz)&#123;</span><br><span class="line">        buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(siz/<span class="number">32</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    ~bitmap()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] buf;</span><br><span class="line">        buf=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(T)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(T)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">bitmap&lt;<span class="keyword">long</span>&gt; <span class="title">vis</span><span class="params">(<span class="number">36344967696</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use queue as Open list</span></span><br><span class="line"><span class="comment">// To save all the states, we use STL vector to simulate queue</span></span><br><span class="line"><span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_misplaced</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(cur.s[i]!=goal.s[i]) num++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Determine if there is a solution</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; fa)</span></span>&#123; <span class="comment">// Print path recursively</span></span><br><span class="line">    <span class="keyword">if</span>(fa==<span class="number">-1</span>) <span class="keyword">return</span>;</span><br><span class="line">    print(v[fa].fa);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;v[fa].s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// Initialize factor[]</span></span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>; <span class="comment">// 0!=1</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    <span class="comment">// Initialize ini state</span></span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    ini.h=calc_misplaced(ini,goal);</span><br><span class="line">    ini.f=ini.steps+ini.h;</span><br><span class="line">    ini.fa=<span class="number">-1</span>;</span><br><span class="line">    q.push(ini);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        state cur=q.top();</span><br><span class="line">        v.push_back(cur);</span><br><span class="line">        v_end++;</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span>(!cur.h)&#123; <span class="comment">// Find!</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;steps: &quot;</span>&lt;&lt;cur.steps&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            print(v_end);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                next.h=calc_misplaced(next,goal);</span><br><span class="line">                next.f=next.steps+next.h;</span><br><span class="line">                next.fa=v_end;</span><br><span class="line">                <span class="keyword">long</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                    vis.visit(code);</span><br><span class="line">                    q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">(state &amp; st)</span></span>&#123;</span><br><span class="line">    <span class="comment">// flexible input method</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;)&#123;</span><br><span class="line">        ch=getchar();</span><br><span class="line">        <span class="keyword">if</span>(ch==<span class="string">&#x27;0&#x27;</span>) st.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span> &amp;&amp; ch&lt;=<span class="string">&#x27;9&#x27;</span>) st.s[i++]=ch-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>,<span class="string">&quot;r&quot;</span>,<span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>,<span class="string">&quot;w&quot;</span>,<span class="built_in">stdout</span>);</span><br><span class="line">    input(ini);</span><br><span class="line">    input(goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) bfs();</span><br><span class="line">    <span class="keyword">else</span> <span class="built_in">cout</span>&lt;&lt;<span class="number">-1</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;time: &quot;</span>&lt;&lt;end-start&lt;&lt;<span class="string">&quot;ms&quot;</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> bitmap&lt;T&gt;::visit(T n)&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n is in the j-th bit of the i-th int</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">    |  1st int |  2nd int |  3rd int |          | i-th int |</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">                                                       ↑</span></span><br><span class="line"><span class="comment">                                                    j-th bit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>; <span class="comment">// Equivalent to j=n%32;</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To change the j-th bit from 0 to 1,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th bit is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then OR the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010</span></span><br><span class="line"><span class="comment">            OR  1100 0010</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> bitmap&lt;T&gt;::is_visited(T n)&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To check the j-th bit,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then AND the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000			        1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010			        0100 0000</span></span><br><span class="line"><span class="comment">           AND  0000 0000 (false)      AND  0100 0000 (true)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GUI-部分代码"><a href="#GUI-部分代码" class="headerlink" title="GUI 部分代码"></a>GUI 部分代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/Stardusten/8_puzzle_QT">GitHub 项目地址</a></p>
<figure class="highlight bash"><figcaption><span>8_puzzle.pro</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">QT       += core gui</span><br><span class="line"></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, 4): QT += widgets</span><br><span class="line"></span><br><span class="line">CONFIG += c++11</span><br><span class="line"></span><br><span class="line"><span class="comment"># You can make your code fail to compile if it uses deprecated APIs.</span></span><br><span class="line"><span class="comment"># In order to do so, uncomment the following line.</span></span><br><span class="line"><span class="comment">#DEFINES += QT_DISABLE_DEPRECATED_BEFORE=0x060000    # disables all the APIs deprecated before Qt 6.0.0</span></span><br><span class="line"></span><br><span class="line">SOURCES += \</span><br><span class="line">    A_star.cpp \</span><br><span class="line">    BFS.cpp \</span><br><span class="line">    DFS.cpp \</span><br><span class="line">    IDA_star.cpp \</span><br><span class="line">    IDDFS.cpp \</span><br><span class="line">    a_star_graph.cpp \</span><br><span class="line">    advanced_analyse_tool.cpp \</span><br><span class="line">    base.cpp \</span><br><span class="line">    bfs_graph.cpp \</span><br><span class="line">    bitmap.cpp \</span><br><span class="line">    dfs_graph.cpp \</span><br><span class="line">    game.cpp \</span><br><span class="line">    graph_select.cpp \</span><br><span class="line">    heu_func_select.cpp \</span><br><span class="line">    ida_star_graph.cpp \</span><br><span class="line">    iddfs_graph.cpp \</span><br><span class="line">    main.cpp \</span><br><span class="line">    eight_puzzle.cpp</span><br><span class="line"></span><br><span class="line">HEADERS += \</span><br><span class="line">    A_star.h \</span><br><span class="line">    BFS.h \</span><br><span class="line">    DFS.h \</span><br><span class="line">    IDA_star.h \</span><br><span class="line">    IDDFS.h \</span><br><span class="line">    a_star_graph.h \</span><br><span class="line">    advanced_analyse_tool.h \</span><br><span class="line">    base.h \</span><br><span class="line">    bfs_graph.h \</span><br><span class="line">    bitmap.h \</span><br><span class="line">    dfs_graph.h \</span><br><span class="line">    eight_puzzle.h \</span><br><span class="line">    game.h \</span><br><span class="line">    graph_select.h \</span><br><span class="line">    heu_func_select.h \</span><br><span class="line">    ida_star_graph.h \</span><br><span class="line">    iddfs_graph.h</span><br><span class="line"></span><br><span class="line">FORMS += \</span><br><span class="line">    eight_puzzle.ui</span><br><span class="line"></span><br><span class="line">TRANSLATIONS += \</span><br><span class="line">    8_puzzle_zh_CN.ts</span><br><span class="line"></span><br><span class="line"><span class="comment"># Default rules for deployment.</span></span><br><span class="line">qnx: target.path = /tmp/$<span class="variable">$&#123;TARGET&#125;</span>/bin</span><br><span class="line"><span class="keyword">else</span>: unix:!android: target.path = /opt/$<span class="variable">$&#123;TARGET&#125;</span>/bin</span><br><span class="line">!isEmpty(target.path): INSTALLS += target</span><br><span class="line"></span><br><span class="line">DISTFILES += \</span><br><span class="line">    ../../8_puzzle/PressButton/0.png \</span><br><span class="line">    ../../8_puzzle/PressButton/1.png \</span><br><span class="line">    ../../8_puzzle/PressButton/2.png \</span><br><span class="line">    ../../8_puzzle/PressButton/3.png \</span><br><span class="line">    ../../8_puzzle/PressButton/4.png \</span><br><span class="line">    ../../8_puzzle/PressButton/5.png \</span><br><span class="line">    ../../8_puzzle/PressButton/6.png \</span><br><span class="line">    ../../8_puzzle/PressButton/7.png \</span><br><span class="line">    ../../8_puzzle/PressButton/8.png</span><br><span class="line"></span><br><span class="line">ICON = Icon.icns</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>main.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;eight_puzzle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;a_star_graph.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">QApplication <span class="title">a</span><span class="params">(argc, argv)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">QPixmap <span class="title">pixmap</span><span class="params">(<span class="string">&quot;/Users/stardust/8_puzzle/Launch.png&quot;</span>)</span></span>;</span><br><span class="line">    pixmap = pixmap.scaled(<span class="number">700</span>, <span class="number">700</span>, Qt::KeepAspectRatio, Qt::SmoothTransformation);</span><br><span class="line"></span><br><span class="line">    <span class="function">QSplashScreen <span class="title">splash</span><span class="params">(pixmap)</span></span>;</span><br><span class="line">    splash.show();</span><br><span class="line"></span><br><span class="line">    eight_puzzle w;</span><br><span class="line">    w.show();</span><br><span class="line">    <span class="comment">//splash.finish(&amp;w);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>BFS.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> BFS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BFS_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QEventLoop&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QTimer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BFS</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>];</span><br><span class="line">        <span class="keyword">int</span> pos;</span><br><span class="line">        <span class="keyword">int</span> fa;</span><br><span class="line">        <span class="keyword">int</span> steps;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line">    <span class="keyword">int</span> nodes=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;state&gt; q;</span><br><span class="line">    <span class="keyword">int</span> front,rear;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_in</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; idx, QString &amp; str)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">QString <span class="title">steps</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(q[front].steps); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">time_used</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number((end-start)/<span class="number">1e3</span>); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">traveled_nodes</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(nodes); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>eight_puzzle.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> EIGHT_PUZZLE_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EIGHT_PUZZLE_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QVBoxLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QHBoxLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QGridLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QLineEdit&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QComboBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QGroupBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QTextBrowser&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QIntValidator&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QSplashScreen&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPlainTextEdit&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPixmap&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123; <span class="class"><span class="keyword">class</span> <span class="title">eight_puzzle</span>;</span> &#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eight_puzzle</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="class"><span class="keyword">class</span> <span class="title">Advanced_analyse_tool</span>;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    eight_puzzle(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~eight_puzzle();</span><br><span class="line">    QTextBrowser *path;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_grid_ini</span><span class="params">(<span class="keyword">const</span> QString &amp;)</span></span>; <span class="comment">// 根据输入实时更新棋盘数据</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_grid_goal</span><span class="params">(<span class="keyword">const</span> QString &amp;)</span></span>; <span class="comment">// 根据输入实时更新棋盘数据</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc_func</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">advanced_func</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::eight_puzzle *ui;</span><br><span class="line">    QLabel *nodes;</span><br><span class="line">    QLabel *time;</span><br><span class="line">    QLabel *memory;</span><br><span class="line">    QLabel *steps;</span><br><span class="line">    QComboBox *method;</span><br><span class="line">    QLineEdit *input_line;</span><br><span class="line">    QLineEdit *output_line;</span><br><span class="line">    QLineEdit *block_ini[<span class="number">9</span>]; <span class="comment">// 初始棋盘布局</span></span><br><span class="line">    QLineEdit *block_goal[<span class="number">9</span>]; <span class="comment">// 目标棋盘布局</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// EIGHT_PUZZLE_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>eight_puzzle.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;eight_puzzle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ui_eight_puzzle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;IDA_star.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;BFS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;IDDFS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;A_star.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DFS.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;advanced_analyse_tool.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">eight_puzzle::eight_puzzle(QWidget *parent)</span><br><span class="line">    : QWidget(parent)</span><br><span class="line">    , ui(<span class="keyword">new</span> Ui::eight_puzzle)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;setupUi(<span class="keyword">this</span>);</span><br><span class="line">    setWindowTitle(<span class="string">&quot;8_puzzle&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QVBoxLayout* mainUI = <span class="keyword">new</span> QVBoxLayout(<span class="keyword">this</span>);</span><br><span class="line">    QHBoxLayout* UP = <span class="keyword">new</span> QHBoxLayout();</span><br><span class="line"></span><br><span class="line">    QGroupBox* Ini = <span class="keyword">new</span> QGroupBox;</span><br><span class="line">    Ini-&gt;setTitle(<span class="string">&quot;Ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QGridLayout* grid_ini = <span class="keyword">new</span> QGridLayout;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        block_ini[i]= <span class="keyword">new</span> QLineEdit;</span><br><span class="line">        block_ini[i]-&gt;setMaximumWidth(<span class="number">20</span>);</span><br><span class="line">        block_ini[i]-&gt;setReadOnly(<span class="literal">true</span>);</span><br><span class="line">        block_ini[i]-&gt;setAlignment(Qt::AlignCenter);</span><br><span class="line">        <span class="comment">// Connect to get input</span></span><br><span class="line">        grid_ini-&gt;addWidget(block_ini[i], i/<span class="number">3</span>, i%<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Ini-&gt;setLayout(grid_ini);</span><br><span class="line">    UP-&gt;addWidget(Ini);</span><br><span class="line"></span><br><span class="line">    QGroupBox* Goal = <span class="keyword">new</span> QGroupBox;</span><br><span class="line">    Goal-&gt;setTitle(<span class="string">&quot;Goal&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QGridLayout* grid_goal = <span class="keyword">new</span> QGridLayout;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        block_goal[i]= <span class="keyword">new</span> QLineEdit;</span><br><span class="line">        block_goal[i]-&gt;setMaximumWidth(<span class="number">20</span>);</span><br><span class="line">        block_goal[i]-&gt;setReadOnly(<span class="literal">true</span>); <span class="comment">// 设为只读</span></span><br><span class="line">        block_goal[i]-&gt;setAlignment(Qt::AlignCenter);</span><br><span class="line">        <span class="comment">// Connect to get input</span></span><br><span class="line">        grid_goal-&gt;addWidget(block_goal[i], i/<span class="number">3</span>, i%<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Goal-&gt;setLayout(grid_goal);</span><br><span class="line">    UP-&gt;addWidget(Goal);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 右栏</span></span><br><span class="line">    QVBoxLayout *r_column = <span class="keyword">new</span> QVBoxLayout;</span><br><span class="line">    <span class="keyword">int</span> cnt=<span class="number">0</span>; <span class="comment">// 纵向行数计数器</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输入输出</span></span><br><span class="line">    QHBoxLayout* IN=<span class="keyword">new</span> QHBoxLayout;</span><br><span class="line">    QLabel *input = <span class="keyword">new</span> QLabel(<span class="string">&quot;Ini: &quot;</span>);</span><br><span class="line">    input_line = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">    input_line-&gt;setMaxLength(<span class="number">9</span>); <span class="comment">// 最多输入 9 个数</span></span><br><span class="line">    input_line-&gt;setValidator(<span class="keyword">new</span> QIntValidator());</span><br><span class="line">    input_line-&gt;setText(<span class="string">&quot;123456780&quot;</span>);</span><br><span class="line">    update_grid_ini(input_line-&gt;text());</span><br><span class="line">    connect(input_line, &amp;QLineEdit::textChanged, <span class="keyword">this</span>, &amp;eight_puzzle::update_grid_ini);</span><br><span class="line">    IN-&gt;addWidget(input);</span><br><span class="line">    IN-&gt;addWidget(input_line);</span><br><span class="line"></span><br><span class="line">    QHBoxLayout* OUT=<span class="keyword">new</span> QHBoxLayout;</span><br><span class="line">    QLabel *output = <span class="keyword">new</span> QLabel(<span class="string">&quot;Goal: &quot;</span>);</span><br><span class="line">    output_line = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">    output_line-&gt;setMaxLength(<span class="number">9</span>); <span class="comment">// 最多输入 9 个数</span></span><br><span class="line">    output_line-&gt;setValidator(<span class="keyword">new</span> QIntValidator());</span><br><span class="line">    output_line-&gt;setText(<span class="string">&quot;103426758&quot;</span>);</span><br><span class="line">    update_grid_goal(output_line-&gt;text());</span><br><span class="line">    connect(output_line, &amp;QLineEdit::textChanged, <span class="keyword">this</span>, &amp;eight_puzzle::update_grid_goal);</span><br><span class="line">    OUT-&gt;addWidget(output,<span class="number">0</span>);</span><br><span class="line">    OUT-&gt;addWidget(output_line,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    r_column-&gt;addLayout(IN,cnt++);</span><br><span class="line">    r_column-&gt;addLayout(OUT,cnt++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 选择计算方法</span></span><br><span class="line">    QHBoxLayout* METHOD = <span class="keyword">new</span> QHBoxLayout;</span><br><span class="line">    QLabel *method_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;Method: &quot;</span>);</span><br><span class="line">    METHOD-&gt;addWidget(method_label,<span class="number">0</span>);</span><br><span class="line">    method = <span class="keyword">new</span> QComboBox;</span><br><span class="line">    method-&gt;addItem(<span class="string">&quot;BFS&quot;</span>);</span><br><span class="line">    method-&gt;addItem(<span class="string">&quot;A*&quot;</span>);</span><br><span class="line">    method-&gt;addItem(<span class="string">&quot;DFS&quot;</span>);</span><br><span class="line">    method-&gt;addItem(<span class="string">&quot;IDDFS&quot;</span>);</span><br><span class="line">    method-&gt;addItem(<span class="string">&quot;IDA*&quot;</span>);</span><br><span class="line">    METHOD-&gt;addWidget(method,<span class="number">1</span>);</span><br><span class="line">    r_column-&gt;addLayout(METHOD, cnt++);</span><br><span class="line"></span><br><span class="line">    QHBoxLayout *buttoms = <span class="keyword">new</span> QHBoxLayout;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  计算</span></span><br><span class="line">    QPushButton *calc = <span class="keyword">new</span> QPushButton(<span class="string">&quot;Calculate&quot;</span>);</span><br><span class="line">    connect(calc, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(calc_func()));</span><br><span class="line">    buttoms-&gt;addWidget(calc);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 高级功能</span></span><br><span class="line">    QPushButton *advanced  = <span class="keyword">new</span> QPushButton(<span class="string">&quot;Advanced&quot;</span>);</span><br><span class="line">    connect(advanced, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(advanced_func()));</span><br><span class="line">    buttoms-&gt;addWidget(advanced);</span><br><span class="line"></span><br><span class="line">    r_column-&gt;addLayout(buttoms);</span><br><span class="line">    UP-&gt;addLayout(r_column);</span><br><span class="line"></span><br><span class="line">    mainUI-&gt;addLayout(UP);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结果部分</span></span><br><span class="line"></span><br><span class="line">    QVBoxLayout *DOWN = <span class="keyword">new</span> QVBoxLayout;</span><br><span class="line"></span><br><span class="line">    QLabel *down_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;Statistics: &quot;</span>);</span><br><span class="line">    DOWN-&gt;addWidget(down_label,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    QHBoxLayout *Statistics = <span class="keyword">new</span> QHBoxLayout;</span><br><span class="line"></span><br><span class="line">    QGridLayout *info = <span class="keyword">new</span> QGridLayout;</span><br><span class="line">    QLabel *nodes_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;     Traveled nodes: &quot;</span>);</span><br><span class="line">    QLabel *time_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;     Time used (ms): &quot;</span>);</span><br><span class="line">    QLabel *memory_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;     Memory used (KB): &quot;</span>);</span><br><span class="line">    QLabel *steps_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;     Steps: &quot;</span>);</span><br><span class="line">    nodes = <span class="keyword">new</span> QLabel;</span><br><span class="line">    time = <span class="keyword">new</span> QLabel;</span><br><span class="line">    memory = <span class="keyword">new</span> QLabel;</span><br><span class="line">    steps = <span class="keyword">new</span> QLabel;</span><br><span class="line">    info-&gt;addWidget(nodes_label,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    info-&gt;addWidget(time_label,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    info-&gt;addWidget(memory_label,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    info-&gt;addWidget(steps_label,<span class="number">3</span>,<span class="number">0</span>);</span><br><span class="line">    info-&gt;addWidget(nodes,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    info-&gt;addWidget(time,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    info-&gt;addWidget(memory,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">    info-&gt;addWidget(steps,<span class="number">3</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    QVBoxLayout *path_col = <span class="keyword">new</span> QVBoxLayout;</span><br><span class="line">    QLabel *path_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;Path: &quot;</span>);</span><br><span class="line">    path = <span class="keyword">new</span> QTextBrowser;</span><br><span class="line">    path-&gt;setMaximumWidth(<span class="number">200</span>);</span><br><span class="line">    path_col-&gt;addWidget(path_label);</span><br><span class="line">    path_col-&gt;addWidget(path);</span><br><span class="line"></span><br><span class="line">    Statistics-&gt;addLayout(info,<span class="number">0</span>);</span><br><span class="line">    Statistics-&gt;addLayout(path_col,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    DOWN-&gt;addLayout(Statistics,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    mainUI-&gt;addLayout(DOWN);</span><br><span class="line"></span><br><span class="line">    resize(<span class="number">500</span>,<span class="number">150</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">eight_puzzle::~eight_puzzle()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eight_puzzle::update_grid_ini</span><span class="params">(<span class="keyword">const</span> QString &amp; in)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;in.count();i++)&#123;</span><br><span class="line">        block_ini[i]-&gt;setText(in.at(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eight_puzzle::update_grid_goal</span><span class="params">(<span class="keyword">const</span> QString &amp; in)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;in.count();i++)&#123;</span><br><span class="line">        block_goal[i]-&gt;setText(in.at(i));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eight_puzzle::calc_func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(input_line-&gt;text().length()&lt;<span class="number">9</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(output_line-&gt;text().length()&lt;<span class="number">9</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">switch</span>(method-&gt;currentIndex())&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:&#123;</span><br><span class="line">        BFS *c0=<span class="keyword">new</span> BFS;</span><br><span class="line">        c0-&gt;<span class="built_in">set</span>(input_line-&gt;text(),output_line-&gt;text());</span><br><span class="line">        c0-&gt;calc();</span><br><span class="line">        steps-&gt;setText(c0-&gt;steps());</span><br><span class="line">        time-&gt;setText(c0-&gt;time_used());</span><br><span class="line">        nodes-&gt;setText(c0-&gt;traveled_nodes());</span><br><span class="line">        path-&gt;setText(c0-&gt;print());</span><br><span class="line">        <span class="keyword">delete</span> c0;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line">        A_star *c1=<span class="keyword">new</span> A_star;</span><br><span class="line">        c1-&gt;<span class="built_in">set</span>(input_line-&gt;text(),output_line-&gt;text());</span><br><span class="line">        c1-&gt;calc();</span><br><span class="line">        steps-&gt;setText(c1-&gt;steps());</span><br><span class="line">        time-&gt;setText(c1-&gt;time_used());</span><br><span class="line">        nodes-&gt;setText(c1-&gt;traveled_nodes());</span><br><span class="line">        path-&gt;setText(c1-&gt;print());</span><br><span class="line">        <span class="keyword">delete</span> c1;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line">        DFS *c2 = <span class="keyword">new</span> DFS;</span><br><span class="line">        c2-&gt;<span class="built_in">set</span>(input_line-&gt;text(),output_line-&gt;text());</span><br><span class="line">        c2-&gt;calc();</span><br><span class="line">        steps-&gt;setText(c2-&gt;steps());</span><br><span class="line">        time-&gt;setText(c2-&gt;time_used());</span><br><span class="line">        nodes-&gt;setText(c2-&gt;traveled_nodes());</span><br><span class="line">        path-&gt;setText(c2-&gt;print());</span><br><span class="line">        <span class="keyword">delete</span> c2;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">        IDDFS *c3 = <span class="keyword">new</span> IDDFS;</span><br><span class="line">        c3-&gt;<span class="built_in">set</span>(input_line-&gt;text(),output_line-&gt;text());</span><br><span class="line">        c3-&gt;calc();</span><br><span class="line">        steps-&gt;setText(c3-&gt;steps());</span><br><span class="line">        time-&gt;setText(c3-&gt;time_used());</span><br><span class="line">        nodes-&gt;setText(c3-&gt;traveled_nodes());</span><br><span class="line">        path-&gt;setText(c3-&gt;print());</span><br><span class="line">        <span class="keyword">delete</span> c3;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:&#123;</span><br><span class="line">        IDA_star *c4 = <span class="keyword">new</span> IDA_star;</span><br><span class="line">        c4-&gt;<span class="built_in">set</span>(input_line-&gt;text(),output_line-&gt;text());</span><br><span class="line">        c4-&gt;calc();</span><br><span class="line">        steps-&gt;setText(c4-&gt;steps());</span><br><span class="line">        time-&gt;setText(c4-&gt;time_used());</span><br><span class="line">        nodes-&gt;setText(c4-&gt;traveled_nodes());</span><br><span class="line">        path-&gt;setText(c4-&gt;print());</span><br><span class="line">        <span class="keyword">delete</span> c4;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">eight_puzzle::advanced_func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Advanced_analyse_tool *ad = <span class="keyword">new</span> Advanced_analyse_tool;</span><br><span class="line">    ad-&gt;<span class="built_in">set</span>(input_line-&gt;text(), output_line-&gt;text(), method-&gt;currentIndex());</span><br><span class="line">    ad-&gt;show();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>graph_select.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Graph_select_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Graph_select_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Graph_select</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘图部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Graph_select</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~Graph_select();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sig_update</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主算法部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">time</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> end-start;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">traveled_nodes</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> nodes;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">need_steps</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> steps;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">        <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">        <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">        <span class="keyword">int</span> f;</span><br><span class="line">        <span class="keyword">double</span> px,py;</span><br><span class="line">        <span class="keyword">double</span> fpx,fpy;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> nodes;</span><br><span class="line">    <span class="keyword">int</span> steps;</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A,B;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> h=<span class="number">20</span>; <span class="comment">// 每层高</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> w[<span class="number">32</span>]=&#123; <span class="comment">// 第 i 层两节点间宽度的一半</span></span><br><span class="line">        <span class="number">300</span>,</span><br><span class="line">        <span class="number">75</span>,</span><br><span class="line">        <span class="number">18.75</span>,</span><br><span class="line">        <span class="number">4.6875</span>,</span><br><span class="line">        <span class="number">1.17188</span>,</span><br><span class="line">        <span class="number">0.292969</span>,</span><br><span class="line">        <span class="number">0.0732422</span>,</span><br><span class="line">        <span class="number">0.0183105</span>,</span><br><span class="line">        <span class="number">0.00457764</span>,</span><br><span class="line">        <span class="number">0.00114441</span>,</span><br><span class="line">        <span class="number">0.000286102</span>,</span><br><span class="line">        <span class="number">7.15256e-05</span>,</span><br><span class="line">        <span class="number">1.78814e-05</span>,</span><br><span class="line">        <span class="number">4.47035e-06</span>,</span><br><span class="line">        <span class="number">1.11759e-06</span>,</span><br><span class="line">        <span class="number">2.79397e-07</span>,</span><br><span class="line">        <span class="number">6.98492e-08</span>,</span><br><span class="line">        <span class="number">1.74623e-08</span>,</span><br><span class="line">        <span class="number">4.36557e-09</span>,</span><br><span class="line">        <span class="number">1.09139e-09</span>,</span><br><span class="line">        <span class="number">2.72848e-10</span>,</span><br><span class="line">        <span class="number">6.82121e-11</span>,</span><br><span class="line">        <span class="number">1.7053e-11</span>,</span><br><span class="line">        <span class="number">4.26326e-12</span>,</span><br><span class="line">        <span class="number">1.06581e-12</span>,</span><br><span class="line">        <span class="number">2.66454e-13</span>,</span><br><span class="line">        <span class="number">6.66134e-14</span>,</span><br><span class="line">        <span class="number">1.66533e-14</span>,</span><br><span class="line">        <span class="number">4.16334e-15</span>,</span><br><span class="line">        <span class="number">1.04083e-15</span>,</span><br><span class="line">        <span class="number">2.60209e-16</span>,</span><br><span class="line">        <span class="number">6.50521e-17</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Graph_select::state &amp;, <span class="keyword">const</span> Graph_select::state &amp;);</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp;,<span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// Graph_select_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>graph_select.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;graph_select.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">Graph_select::Graph_select(QWidget* parent)</span><br><span class="line">    : QWidget(parent)&#123;</span><br><span class="line">    setWindowTitle(<span class="string">&quot;Advanced Analyse Tools&quot;</span>);</span><br><span class="line">    resize(<span class="number">650</span>,<span class="number">700</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Graph_select::~Graph_select()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> Graph_select::state &amp; x, <span class="keyword">const</span> Graph_select::state &amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Graph_select::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2, <span class="keyword">const</span> <span class="keyword">int</span> &amp; _A, <span class="keyword">const</span> <span class="keyword">int</span> &amp; _B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">    A=_A;</span><br><span class="line">    B=_B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Graph_select::calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cur.s[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Graph_select::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Graph_select::paintEvent</span><span class="params">(QPaintEvent *)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    qDebug()&lt;&lt;A&lt;&lt;B&lt;&lt;Qt::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定绘图设备</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抗锯齿</span></span><br><span class="line">    painter.setRenderHint(QPainter::Antialiasing);</span><br><span class="line">    painter.setRenderHint(QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画笔</span></span><br><span class="line">    QPen penLine;</span><br><span class="line">    penLine.setWidth(<span class="number">1</span>); <span class="comment">//线宽</span></span><br><span class="line">    penLine.setColor(Qt::black); <span class="comment">//划线颜色</span></span><br><span class="line">    penLine.setStyle(Qt::SolidLine); <span class="comment">//线的类型，实线、虚线等</span></span><br><span class="line">    penLine.setCapStyle(Qt::FlatCap); <span class="comment">//线端点样式</span></span><br><span class="line">    penLine.setJoinStyle(Qt::BevelJoin); <span class="comment">//线的连接点样式</span></span><br><span class="line">    painter.setBrush(Qt::red); <span class="comment">// 填充颜色</span></span><br><span class="line">    painter.setPen(penLine);</span><br><span class="line"></span><br><span class="line">    <span class="function">QFont <span class="title">font</span><span class="params">(<span class="string">&quot;Fira Code&quot;</span>, <span class="number">13</span>, QFont::Normal, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    painter.setFont(font);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画布</span></span><br><span class="line">    painter.translate(<span class="number">300</span>,<span class="number">30</span>); <span class="comment">// 坐标原点初始化为 画布上边缘中点</span></span><br><span class="line"></span><br><span class="line">    start=clock();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!q.empty()) q.pop();</span><br><span class="line">        <span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line">        ini.steps=<span class="number">0</span>;</span><br><span class="line">        ini.h=calc_manhattan(ini,goal);</span><br><span class="line">        ini.f=A*ini.steps+B*ini.h;</span><br><span class="line">        ini.px=ini.py=ini.fpx=ini.fpy=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        painter.drawEllipse(ini.px<span class="number">-4</span>,ini.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">        painter.drawText(ini.px<span class="number">-10</span>,ini.py<span class="number">-10</span>,<span class="string">&quot;Ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        q.push(ini);</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            state cur=q.top();</span><br><span class="line">            q.pop();</span><br><span class="line">            painter.drawLine(cur.px,cur.py,cur.fpx,cur.fpy); <span class="comment">// 画线</span></span><br><span class="line">            <span class="keyword">if</span>(!cur.h)&#123;</span><br><span class="line">                steps=cur.steps;</span><br><span class="line">                painter.drawEllipse(cur.px<span class="number">-4</span>,cur.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">                painter.drawText(cur.px<span class="number">-15</span>,cur.py+<span class="number">18</span>,<span class="string">&quot;Goal&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            nodes++;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">                <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                    <span class="comment">// Construct the new state after move</span></span><br><span class="line">                    state next;</span><br><span class="line">                    <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                    next.pos=d[cur.pos][i];</span><br><span class="line">                    <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                    next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                    next.h=calc_manhattan(next,goal);</span><br><span class="line">                    next.f=A*next.steps+B*next.h;</span><br><span class="line">                    <span class="comment">// 设置 next 坐标</span></span><br><span class="line">                    next.px=cur.px-(<span class="number">3.0</span>-i*<span class="number">2</span>)*w[next.steps];</span><br><span class="line">                    next.py=cur.py+h;</span><br><span class="line">                    next.fpx=cur.px;</span><br><span class="line">                    next.fpy=cur.py;</span><br><span class="line">                    <span class="comment">//qDebug()&lt;&lt;next.px&lt;&lt;&#x27; &#x27;&lt;&lt;next.py&lt;&lt;Qt::endl;</span></span><br><span class="line">                    <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                    <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                        vis.visit(code);</span><br><span class="line">                        q.push(next);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    end=clock();</span><br><span class="line">    <span class="function">emit <span class="title">sig_update</span><span class="params">((end-start)/<span class="number">1e3</span>, nodes, steps)</span></span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>heu_func_select.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> Heu_func_select_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Heu_func_select_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QLineEdit&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QHBoxLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QVBoxLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QLabel&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QGroupBox&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Heu_func_select</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘图部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Heu_func_select</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~Heu_func_select();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_A</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_B</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">graph</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> A,B;</span><br><span class="line">    QLineEdit *IN_line;</span><br><span class="line">    QLineEdit *OUT_line;</span><br><span class="line">    QString ini_line;</span><br><span class="line">    QString goal_line;</span><br><span class="line">    QLabel *nodes_show;</span><br><span class="line">    QLabel *time_show;</span><br><span class="line">    QLabel *steps_show;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// Heu_func_select_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>heu_func_select.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;heu_func_select.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;graph_select.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">Heu_func_select::Heu_func_select(QWidget* parent)</span><br><span class="line">    : QWidget(parent)&#123;</span><br><span class="line">    setWindowTitle(<span class="string">&quot;Heu_func Comparison&quot;</span>);</span><br><span class="line"></span><br><span class="line">    QHBoxLayout *mainUI = <span class="keyword">new</span> QHBoxLayout(<span class="keyword">this</span>);</span><br><span class="line">    QVBoxLayout *L = <span class="keyword">new</span> QVBoxLayout;</span><br><span class="line"></span><br><span class="line">    QLabel *Introduction = <span class="keyword">new</span> QLabel(<span class="string">&quot;f(x)=A*g(x)+B*h(x)&quot;</span>);</span><br><span class="line">    QLabel *IN_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;Input A: &quot;</span>);</span><br><span class="line">    QLabel *OUT_label = <span class="keyword">new</span> QLabel(<span class="string">&quot;Input B: &quot;</span>);</span><br><span class="line">    IN_line = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">    OUT_line = <span class="keyword">new</span> QLineEdit;</span><br><span class="line">    connect(IN_line, &amp;QLineEdit::textChanged, <span class="keyword">this</span>, &amp;Heu_func_select::update_A);</span><br><span class="line">    connect(OUT_line, &amp;QLineEdit::textChanged, <span class="keyword">this</span>, &amp;Heu_func_select::update_B);</span><br><span class="line">    QHBoxLayout *IN = <span class="keyword">new</span> QHBoxLayout;</span><br><span class="line">    IN-&gt;addWidget(IN_label);</span><br><span class="line">    IN-&gt;addWidget(IN_line);</span><br><span class="line">    QHBoxLayout *OUT = <span class="keyword">new</span> QHBoxLayout;</span><br><span class="line">    OUT-&gt;addWidget(OUT_label);</span><br><span class="line">    OUT-&gt;addWidget(OUT_line);</span><br><span class="line">    QPushButton *Bt = <span class="keyword">new</span> QPushButton(<span class="string">&quot;Analyse&quot;</span>);</span><br><span class="line">    connect(Bt, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(graph()));</span><br><span class="line"></span><br><span class="line">    L-&gt;addWidget(Introduction);</span><br><span class="line">    L-&gt;addLayout(IN);</span><br><span class="line">    L-&gt;addLayout(OUT);</span><br><span class="line">    L-&gt;addWidget(Bt);</span><br><span class="line"></span><br><span class="line">    QGroupBox *info = <span class="keyword">new</span> QGroupBox;</span><br><span class="line">    info-&gt;setTitle(<span class="string">&quot;Statistics&quot;</span>);</span><br><span class="line">    QGridLayout *info_grid = <span class="keyword">new</span> QGridLayout;</span><br><span class="line">    QLabel *nodes = <span class="keyword">new</span> QLabel(<span class="string">&quot;Travelled nodes: &quot;</span>);</span><br><span class="line">    QLabel *time = <span class="keyword">new</span> QLabel(<span class="string">&quot;Time used (ms): &quot;</span>);</span><br><span class="line">    QLabel *steps = <span class="keyword">new</span> QLabel(<span class="string">&quot;Steps: &quot;</span>);</span><br><span class="line">    nodes_show = <span class="keyword">new</span> QLabel;</span><br><span class="line">    nodes_show-&gt;setMinimumWidth(<span class="number">50</span>);</span><br><span class="line">    time_show = <span class="keyword">new</span> QLabel;</span><br><span class="line">    time_show-&gt;setMinimumWidth(<span class="number">50</span>);</span><br><span class="line">    steps_show = <span class="keyword">new</span> QLabel;</span><br><span class="line">    steps_show-&gt;setMinimumWidth(<span class="number">50</span>);</span><br><span class="line">    info_grid-&gt;addWidget(nodes,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    info_grid-&gt;addWidget(nodes_show,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">    info_grid-&gt;addWidget(time,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    info_grid-&gt;addWidget(time_show,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">    info_grid-&gt;addWidget(steps,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line">    info_grid-&gt;addWidget(steps_show,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line">    info-&gt;setLayout(info_grid);</span><br><span class="line"></span><br><span class="line">    mainUI-&gt;addLayout(L);</span><br><span class="line">    mainUI-&gt;addWidget(info);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Heu_func_select::update_A</span><span class="params">()</span></span>&#123;</span><br><span class="line">    A=IN_line-&gt;text().toInt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Heu_func_select::update_B</span><span class="params">()</span></span>&#123;</span><br><span class="line">    B=OUT_line-&gt;text().toInt();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Heu_func_select::~Heu_func_select()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Heu_func_select::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2, <span class="keyword">const</span> <span class="keyword">int</span> &amp; _A, <span class="keyword">const</span> <span class="keyword">int</span> &amp; _B)</span></span>&#123;</span><br><span class="line">    ini_line=input1;</span><br><span class="line">    goal_line=input2;</span><br><span class="line">    A=_A;</span><br><span class="line">    B=_B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Heu_func_select::graph</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Graph_select *g = <span class="keyword">new</span> Graph_select;</span><br><span class="line">    connect(g, SIGNAL(sig_update(<span class="keyword">const</span> <span class="keyword">double</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span>&amp;)), <span class="keyword">this</span>, SLOT(update(<span class="keyword">const</span> <span class="keyword">double</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)));</span><br><span class="line">    g-&gt;<span class="built_in">set</span>(ini_line, goal_line, A, B);</span><br><span class="line">    g-&gt;show();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Heu_func_select::update</span><span class="params">(<span class="keyword">const</span> <span class="keyword">double</span> &amp; t, <span class="keyword">const</span> <span class="keyword">int</span> &amp; n, <span class="keyword">const</span> <span class="keyword">int</span> &amp; s)</span></span>&#123;</span><br><span class="line">    time_show-&gt;setText(QString::number(t));</span><br><span class="line">    nodes_show-&gt;setText(QString::number(n));</span><br><span class="line">    steps_show-&gt;setText(QString::number(s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>BFS.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;BFS.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS::print_in</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; idx, QString &amp; ans)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(~idx)&#123;</span><br><span class="line">        print_in(q[idx].fa, ans);</span><br><span class="line">        QString tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">            tmp.<span class="built_in">sprintf</span>(<span class="string">&quot;%d &quot;</span>,q[idx].s[i]);</span><br><span class="line">            ans+=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">BFS::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QString ans;</span><br><span class="line">    <span class="keyword">if</span>(q.empty())&#123;</span><br><span class="line">        ans.append(<span class="string">&quot;No Solution.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    print_in(front, ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS::bfs</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line">    ini.fa=<span class="number">-1</span>; <span class="comment">// Recursive termination condition</span></span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    q.push_back(ini); <span class="comment">// Push ini state into the Open list</span></span><br><span class="line">    front=<span class="number">0</span>, rear=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(front&lt;rear)&#123; <span class="comment">// Loop until queue is empty</span></span><br><span class="line">        state cur=q[front];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123; <span class="comment">// Find!</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        nodes++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.fa=front;</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">// Encode new state</span></span><br><span class="line">                <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123; <span class="comment">// If the new state is unvisited</span></span><br><span class="line">                    vis.visit(code); <span class="comment">// Mark it as visited</span></span><br><span class="line">                    q.push_back(next); <span class="comment">// Add it to the Open list</span></span><br><span class="line">                    rear++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        front++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS::calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) bfs();</span><br><span class="line">    end=clock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>DFS.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*#ifndef DFS_H</span></span><br><span class="line"><span class="comment">#define DFS_H</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#include&lt;stack&gt;</span></span><br><span class="line"><span class="comment">#include&lt;ctime&gt;</span></span><br><span class="line"><span class="comment">#include&lt;string&gt;</span></span><br><span class="line"><span class="comment">#include&lt;algorithm&gt;</span></span><br><span class="line"><span class="comment">#include&lt;QString&gt;</span></span><br><span class="line"><span class="comment">#include&lt;QDebug&gt;</span></span><br><span class="line"><span class="comment">#include&quot;algo_base.h&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">class DFS&#123;</span></span><br><span class="line"><span class="comment">private:</span></span><br><span class="line"><span class="comment">    // 数据成员</span></span><br><span class="line"><span class="comment">    struct state&#123;</span></span><br><span class="line"><span class="comment">        int s[9]; // 0 represents Space</span></span><br><span class="line"><span class="comment">        int pos; // Position of space</span></span><br><span class="line"><span class="comment">    &#125;ini,goal;</span></span><br><span class="line"><span class="comment">    int nodes=0,need_steps;</span></span><br><span class="line"><span class="comment">    std::stack&lt;state&gt; path;</span></span><br><span class="line"><span class="comment">    clock_t start,end;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // 工具函数</span></span><br><span class="line"><span class="comment">    bool is_solvable(const state &amp;, const state &amp;);</span></span><br><span class="line"><span class="comment">    bool DFS_in(state &amp;, const int &amp;, bitmap &amp;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">public:</span></span><br><span class="line"><span class="comment">    void set(const QString &amp;, const QString &amp;);</span></span><br><span class="line"><span class="comment">    void calc();</span></span><br><span class="line"><span class="comment">    QString steps()&#123; return path.empty()?QString(&quot;&quot;):QString::number(need_steps); &#125;</span></span><br><span class="line"><span class="comment">    QString time_used()&#123; return path.empty()?QString(&quot;&quot;):QString::number(end-start); &#125;</span></span><br><span class="line"><span class="comment">    QString traveled_nodes()&#123; return path.empty()?QString(&quot;&quot;):QString::number(nodes); &#125;</span></span><br><span class="line"><span class="comment">    QString print();</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">bool DFS::is_solvable(const state &amp; ini, const state &amp; goal)&#123;</span></span><br><span class="line"><span class="comment">    int n1=0,n2=0;</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;9;i++)&#123;</span></span><br><span class="line"><span class="comment">        for(int j=i+1;j&lt;9;j++)&#123;</span></span><br><span class="line"><span class="comment">            if(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=0) n1++;</span></span><br><span class="line"><span class="comment">            if(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=0) n2++;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    if((n1&amp;1)!=(n2&amp;1)) return 0;</span></span><br><span class="line"><span class="comment">    return 1;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">bool DFS::DFS_in(state &amp; cur, const int &amp; steps, bitmap &amp; vis)&#123;</span></span><br><span class="line"><span class="comment">    if(!memcmp(cur.s,goal.s,sizeof(goal.s)))&#123;</span></span><br><span class="line"><span class="comment">        need_steps=steps;</span></span><br><span class="line"><span class="comment">        path.push(cur);</span></span><br><span class="line"><span class="comment">        return true;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    nodes++;</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;4;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(~d[cur.pos][i])&#123;</span></span><br><span class="line"><span class="comment">            state next;</span></span><br><span class="line"><span class="comment">            memcpy(next.s,cur.s,sizeof(cur.s));</span></span><br><span class="line"><span class="comment">            next.pos=d[cur.pos][i];</span></span><br><span class="line"><span class="comment">            std::swap(next.s[cur.pos],next.s[next.pos]);</span></span><br><span class="line"><span class="comment">            int code=encode(next.s);</span></span><br><span class="line"><span class="comment">            if(vis.is_visited(code)) continue;</span></span><br><span class="line"><span class="comment">            vis.visit(code);</span></span><br><span class="line"><span class="comment">            if(DFS_in(next, steps+1, vis))&#123;</span></span><br><span class="line"><span class="comment">                path.push(cur);</span></span><br><span class="line"><span class="comment">                return true;</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            vis.undo_visit(code);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return false;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">bool DFS::DFS_in(state &amp; cur, const int &amp; steps, bitmap &amp; vis)&#123;</span></span><br><span class="line"><span class="comment">    if(!memcmp(cur.s,goal.s,sizeof(goal.s)))&#123;</span></span><br><span class="line"><span class="comment">        need_steps=steps;</span></span><br><span class="line"><span class="comment">        path.push(cur);</span></span><br><span class="line"><span class="comment">        return true;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    nodes++;</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;4;i++)&#123;</span></span><br><span class="line"><span class="comment">        if(~d[cur.pos][i])&#123;</span></span><br><span class="line"><span class="comment">            state next;</span></span><br><span class="line"><span class="comment">            memcpy(next.s,cur.s,sizeof(cur.s));</span></span><br><span class="line"><span class="comment">            next.pos=d[cur.pos][i];</span></span><br><span class="line"><span class="comment">            std::swap(next.s[cur.pos],next.s[next.pos]);</span></span><br><span class="line"><span class="comment">            int code=encode(next.s);</span></span><br><span class="line"><span class="comment">            if(!vis.is_visited(code))&#123;</span></span><br><span class="line"><span class="comment">                vis.visit(code);</span></span><br><span class="line"><span class="comment">                if(DFS_in(next, steps+1, vis))&#123;</span></span><br><span class="line"><span class="comment">                    path.push(cur);</span></span><br><span class="line"><span class="comment">                    return true;</span></span><br><span class="line"><span class="comment">                &#125;</span></span><br><span class="line"><span class="comment">                vis.undo_visit(code);</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return false;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void DFS::set(const QString &amp; input1, const QString &amp; input2)&#123;</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;9;i++)&#123;</span></span><br><span class="line"><span class="comment">        ini.s[i]=int(input1[i].toLatin1()-&#x27;0&#x27;);</span></span><br><span class="line"><span class="comment">        goal.s[i]=int(input2[i].toLatin1()-&#x27;0&#x27;);</span></span><br><span class="line"><span class="comment">        if(!ini.s[i]) ini.pos=i;</span></span><br><span class="line"><span class="comment">        if(!goal.s[i]) goal.pos=i;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">void DFS::calc()&#123;</span></span><br><span class="line"><span class="comment">    bitmap vis(362880);</span></span><br><span class="line"><span class="comment">    start=clock();</span></span><br><span class="line"><span class="comment">    vis.visit(encode(ini.s));</span></span><br><span class="line"><span class="comment">    if(is_solvable(ini,goal))&#123;</span></span><br><span class="line"><span class="comment">        DFS_in(ini,0,vis);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    end=clock();</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">QString DFS::print()&#123;</span></span><br><span class="line"><span class="comment">    QString ans;</span></span><br><span class="line"><span class="comment">    if(path.empty())&#123;</span></span><br><span class="line"><span class="comment">        ans.append(&quot;No Solution.&quot;);</span></span><br><span class="line"><span class="comment">        return ans;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    while(!path.empty())&#123;</span></span><br><span class="line"><span class="comment">        state &amp; cur = path.top();</span></span><br><span class="line"><span class="comment">        QString tmp;</span></span><br><span class="line"><span class="comment">        for(int i=0;i&lt;9;i++)&#123;</span></span><br><span class="line"><span class="comment">            tmp.sprintf(&quot;%d &quot;,cur.s[i]);</span></span><br><span class="line"><span class="comment">            ans+=tmp;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        ans+=&#x27;\n&#x27;;</span></span><br><span class="line"><span class="comment">        path.pop();</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return ans;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#endif // DFS_H</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DFS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DFS_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DFS</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    &#125;ini,goal;</span><br><span class="line">    <span class="keyword">int</span> max_f=<span class="number">30</span>,nodes=<span class="number">0</span>,need_steps;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;state&gt; path;</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">DFS_in</span><span class="params">(state &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">QString <span class="title">steps</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(need_steps); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">time_used</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number((end-start)/<span class="number">1e3</span>); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">traveled_nodes</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(nodes); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DFS_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>DFS.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;DFS.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DFS::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DFS::DFS_in</span><span class="params">(state &amp; cur, <span class="keyword">const</span> <span class="keyword">int</span> &amp; steps, <span class="keyword">const</span> <span class="keyword">int</span> &amp; prepos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123;</span><br><span class="line">        need_steps=steps;</span><br><span class="line">        path.push(cur);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(steps&gt;max_f) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    nodes++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d[cur.pos][i]==prepos) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(~d[cur.pos][i])&#123;</span><br><span class="line">            state next;</span><br><span class="line">            <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">            next.pos=d[cur.pos][i];</span><br><span class="line">            <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">            <span class="keyword">if</span>(DFS_in(next, steps+<span class="number">1</span>, cur.pos))&#123;</span><br><span class="line">                path.push(cur);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS::calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        DFS_in(ini,<span class="number">0</span>,<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    end=clock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">DFS::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QString ans;</span><br><span class="line">    <span class="keyword">if</span>(path.empty())&#123;</span><br><span class="line">        ans.append(<span class="string">&quot;No Solution.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!path.empty())&#123;</span><br><span class="line">        state &amp; cur = path.top();</span><br><span class="line">        QString tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">            tmp.<span class="built_in">sprintf</span>(<span class="string">&quot;%d &quot;</span>,cur.s[i]);</span><br><span class="line">            ans+=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        path.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>IDDFS.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> IDDFS_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IDDFS_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IDDFS</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    &#125;ini,goal;</span><br><span class="line">    <span class="keyword">int</span> max_f=<span class="number">1</span>,nodes=<span class="number">0</span>,need_steps;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;state&gt; path;</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IDDFS_in</span><span class="params">(state &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">QString <span class="title">steps</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(need_steps); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">time_used</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number((end-start)/<span class="number">1e3</span>); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">traveled_nodes</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(nodes); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// IDDFS_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>IDDFS.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;IDDFS.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDDFS::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDDFS::IDDFS_in</span><span class="params">(state &amp; cur, <span class="keyword">const</span> <span class="keyword">int</span> &amp; steps, <span class="keyword">const</span> <span class="keyword">int</span> &amp; prepos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123;</span><br><span class="line">        need_steps=steps;</span><br><span class="line">        path.push(cur);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(steps&gt;max_f) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    nodes++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d[cur.pos][i]==prepos) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(~d[cur.pos][i])&#123;</span><br><span class="line">            state next;</span><br><span class="line">            <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">            next.pos=d[cur.pos][i];</span><br><span class="line">            <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">            <span class="keyword">if</span>(IDDFS_in(next, steps+<span class="number">1</span>, cur.pos))&#123;</span><br><span class="line">                path.push(cur);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDDFS::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDDFS::calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!IDDFS_in(ini,<span class="number">0</span>,<span class="number">-1</span>)) max_f++;</span><br><span class="line">    &#125;</span><br><span class="line">    end=clock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">IDDFS::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QString ans;</span><br><span class="line">    <span class="keyword">if</span>(path.empty())&#123;</span><br><span class="line">        ans.append(<span class="string">&quot;No Solution.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!path.empty())&#123;</span><br><span class="line">        state &amp; cur = path.top();</span><br><span class="line">        QString tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">            tmp.<span class="built_in">sprintf</span>(<span class="string">&quot;%d &quot;</span>,cur.s[i]);</span><br><span class="line">            ans+=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        path.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>A_star.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> A_STAR_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> A_STAR_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A_star</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">        <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">        <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">        <span class="keyword">int</span> f;</span><br><span class="line">        <span class="keyword">int</span> fa;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> A_star_steps, nodes=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;state&gt; v;</span><br><span class="line">    <span class="keyword">int</span> v_end=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> A_star::state &amp;, <span class="keyword">const</span> A_star::state &amp;);</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp;,<span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">A_star_calc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print_in</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp;, QString &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line">    <span class="function">QString <span class="title">steps</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(A_star_steps); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">time_used</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number((end-start)/<span class="number">1e3</span>); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">traveled_nodes</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> q.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(nodes); &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">QString <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// A_STAR_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>A_star.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;A_star.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> A_star::state &amp; x, <span class="keyword">const</span> A_star::state &amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">A_star::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">A_star::calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cur.s[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">A_star::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">A_star::A_star_calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    ini.h=calc_manhattan(ini,goal);</span><br><span class="line">    ini.f=ini.steps+ini.h;</span><br><span class="line">    ini.fa=<span class="number">-1</span>;</span><br><span class="line">    q.push(ini);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">        state cur=q.top();</span><br><span class="line">        v.push_back(cur);</span><br><span class="line">        v_end++;</span><br><span class="line">        q.pop();</span><br><span class="line">        <span class="keyword">if</span>(!cur.h)&#123; <span class="comment">// Find!</span></span><br><span class="line">            A_star_steps=cur.steps;</span><br><span class="line">            <span class="comment">//print(v_end);</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        nodes++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                next.h=calc_manhattan(next,goal);</span><br><span class="line">                next.f=next.steps+next.h;</span><br><span class="line">                next.fa=v_end;</span><br><span class="line">                <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                    vis.visit(code);</span><br><span class="line">                    q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">A_star::calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal)) A_star_calc();</span><br><span class="line">    end=clock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">A_star::print_in</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> &amp; idx, QString &amp; ans)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(~idx)&#123;</span><br><span class="line">        print_in(v[idx].fa, ans);</span><br><span class="line">        QString tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">            tmp.<span class="built_in">sprintf</span>(<span class="string">&quot;%d &quot;</span>,v[idx].s[i]);</span><br><span class="line">            ans+=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">A_star::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QString ans;</span><br><span class="line">    <span class="keyword">if</span>(v.empty())&#123;</span><br><span class="line">        ans.append(<span class="string">&quot;No Solution.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    print_in(v_end, ans);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>IDA_star.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> IDA_STAR</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IDA_STAR</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IDA_star</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">    &#125;ini,goal;</span><br><span class="line">    <span class="keyword">int</span> max_f,nodes=<span class="number">0</span>,need_steps;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;state&gt; path;</span><br><span class="line">    <span class="keyword">clock_t</span> start,end;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp;,<span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IDA_star_in</span><span class="params">(state &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">calc</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">QString <span class="title">steps</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(need_steps); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">time_used</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number((end-start)/<span class="number">1e3</span>); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">traveled_nodes</span><span class="params">()</span></span>&#123; <span class="keyword">return</span> path.empty()?QString(<span class="string">&quot;&quot;</span>):QString::number(nodes); &#125;</span><br><span class="line">    <span class="function">QString <span class="title">print</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>IDA_star.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;IDA_star.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">IDA_star::calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cur.s[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDA_star::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDA_star::IDA_star_in</span><span class="params">(state &amp; cur, <span class="keyword">const</span> <span class="keyword">int</span> &amp; steps, <span class="keyword">const</span> <span class="keyword">int</span> &amp; h, <span class="keyword">const</span> <span class="keyword">int</span> &amp; prepos)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123;</span><br><span class="line">        need_steps=steps;</span><br><span class="line">        path.push(cur);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(steps+h&gt;max_f) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    nodes++;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(d[cur.pos][i]==prepos) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(~d[cur.pos][i])&#123;</span><br><span class="line">            state next;</span><br><span class="line">            <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">            next.pos=d[cur.pos][i];</span><br><span class="line">            <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">            <span class="keyword">if</span>(IDA_star_in(next, steps+<span class="number">1</span>, calc_manhattan(next,goal), cur.pos))&#123;</span><br><span class="line">                path.push(cur);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDA_star::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDA_star::calc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    max_f=calc_manhattan(ini,goal);</span><br><span class="line">    start=clock();</span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!IDA_star_in(ini,<span class="number">0</span>,max_f,<span class="number">-1</span>)) max_f++;</span><br><span class="line">    &#125;</span><br><span class="line">    end=clock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QString <span class="title">IDA_star::print</span><span class="params">()</span></span>&#123;</span><br><span class="line">    QString ans;</span><br><span class="line">    <span class="keyword">if</span>(path.empty())&#123;</span><br><span class="line">        ans.append(<span class="string">&quot;No Solution.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!path.empty())&#123;</span><br><span class="line">        state &amp; cur = path.top();</span><br><span class="line">        QString tmp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">            tmp.<span class="built_in">sprintf</span>(<span class="string">&quot;%d &quot;</span>,cur.s[i]);</span><br><span class="line">            ans+=tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        ans+=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        path.pop();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>advanced_analyse_tool.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> ADVANCED_ANALYSE_TOOL_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ADVANCED_ANALYSE_TOOL_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QGridLayout&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPushButton&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QString&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Advanced_analyse_tool</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Advanced_analyse_tool</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">    ~Advanced_analyse_tool()&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> <span class="keyword">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Visualize_func</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Heu_analyse_func</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QString input_line;</span><br><span class="line">    QString output_line;</span><br><span class="line">    <span class="keyword">int</span> method;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// ADVANCED_ANALYSE_TOOL_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>advanced_analyse_tool.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;advanced_analyse_tool.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bfs_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;a_star_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;dfs_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;iddfs_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;ida_star_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;heu_func_select.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">Advanced_analyse_tool::Advanced_analyse_tool(QWidget *parent) : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">    QGridLayout *select = <span class="keyword">new</span> QGridLayout(<span class="keyword">this</span>);</span><br><span class="line">    QPushButton *Visualize = <span class="keyword">new</span> QPushButton;</span><br><span class="line">    Visualize-&gt;setText(<span class="string">&quot;Visualize&quot;</span>);</span><br><span class="line">    connect(Visualize, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(Visualize_func()));</span><br><span class="line">    QPushButton *Heu = <span class="keyword">new</span> QPushButton;</span><br><span class="line">    Heu-&gt;setText(<span class="string">&quot;Heu Analyse&quot;</span>);</span><br><span class="line">    connect(Heu, SIGNAL(clicked()), <span class="keyword">this</span>, SLOT(Heu_analyse_func()));</span><br><span class="line">    select-&gt;addWidget(Visualize,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    select-&gt;addWidget(Heu,<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    setWindowTitle(<span class="string">&quot;Advanced Analyse Tools&quot;</span>);</span><br><span class="line">    resize(<span class="number">250</span>,<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Advanced_analyse_tool::set</span><span class="params">(<span class="keyword">const</span> QString &amp; _input_line, <span class="keyword">const</span> QString &amp; _output_line, <span class="keyword">const</span> <span class="keyword">int</span> &amp; _method)</span></span>&#123;</span><br><span class="line">    input_line=_input_line;</span><br><span class="line">    output_line=_output_line;</span><br><span class="line">    method=_method;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Advanced_analyse_tool::Visualize_func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(input_line.length()&lt;<span class="number">9</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span>(output_line.length()&lt;<span class="number">9</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">switch</span>(method)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:&#123;</span><br><span class="line">        BFS_graph *g0 = <span class="keyword">new</span> BFS_graph;</span><br><span class="line">        g0-&gt;<span class="built_in">set</span>(input_line, output_line);</span><br><span class="line">        g0-&gt;show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:&#123;</span><br><span class="line">        A_star_graph *g1 = <span class="keyword">new</span> A_star_graph;</span><br><span class="line">        g1-&gt;<span class="built_in">set</span>(input_line, output_line);</span><br><span class="line">        g1-&gt;show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:&#123;</span><br><span class="line">        DFS_graph *g2 = <span class="keyword">new</span> DFS_graph;</span><br><span class="line">        g2-&gt;<span class="built_in">set</span>(input_line, output_line);</span><br><span class="line">        g2-&gt;show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:&#123;</span><br><span class="line">        IDDFS_graph *g3 = <span class="keyword">new</span> IDDFS_graph;</span><br><span class="line">        g3-&gt;<span class="built_in">set</span>(input_line, output_line);</span><br><span class="line">        g3-&gt;show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:&#123;</span><br><span class="line">        IDA_star_graph *g4 = <span class="keyword">new</span> IDA_star_graph;</span><br><span class="line">        g4-&gt;<span class="built_in">set</span>(input_line, output_line);</span><br><span class="line">        g4-&gt;show();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>-&gt;close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Advanced_analyse_tool::Heu_analyse_func</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Heu_func_select *s = <span class="keyword">new</span> Heu_func_select;</span><br><span class="line">    s-&gt;<span class="built_in">set</span>(input_line, output_line, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    s-&gt;show();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>bfs_graph.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> BFS_GRAPH_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BFS_GRAPH_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BFS_graph</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘图部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BFS_graph</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~BFS_graph();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主算法部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">        <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">        <span class="keyword">double</span> px,py;</span><br><span class="line">        <span class="keyword">double</span> fpx,fpy;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> h=<span class="number">20</span>; <span class="comment">// 每层高</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> w[<span class="number">32</span>]=&#123; <span class="comment">// 第 i 层两节点间宽度的一半</span></span><br><span class="line">        <span class="number">300</span>,</span><br><span class="line">        <span class="number">75</span>,</span><br><span class="line">        <span class="number">18.75</span>,</span><br><span class="line">        <span class="number">4.6875</span>,</span><br><span class="line">        <span class="number">1.17188</span>,</span><br><span class="line">        <span class="number">0.292969</span>,</span><br><span class="line">        <span class="number">0.0732422</span>,</span><br><span class="line">        <span class="number">0.0183105</span>,</span><br><span class="line">        <span class="number">0.00457764</span>,</span><br><span class="line">        <span class="number">0.00114441</span>,</span><br><span class="line">        <span class="number">0.000286102</span>,</span><br><span class="line">        <span class="number">7.15256e-05</span>,</span><br><span class="line">        <span class="number">1.78814e-05</span>,</span><br><span class="line">        <span class="number">4.47035e-06</span>,</span><br><span class="line">        <span class="number">1.11759e-06</span>,</span><br><span class="line">        <span class="number">2.79397e-07</span>,</span><br><span class="line">        <span class="number">6.98492e-08</span>,</span><br><span class="line">        <span class="number">1.74623e-08</span>,</span><br><span class="line">        <span class="number">4.36557e-09</span>,</span><br><span class="line">        <span class="number">1.09139e-09</span>,</span><br><span class="line">        <span class="number">2.72848e-10</span>,</span><br><span class="line">        <span class="number">6.82121e-11</span>,</span><br><span class="line">        <span class="number">1.7053e-11</span>,</span><br><span class="line">        <span class="number">4.26326e-12</span>,</span><br><span class="line">        <span class="number">1.06581e-12</span>,</span><br><span class="line">        <span class="number">2.66454e-13</span>,</span><br><span class="line">        <span class="number">6.66134e-14</span>,</span><br><span class="line">        <span class="number">1.66533e-14</span>,</span><br><span class="line">        <span class="number">4.16334e-15</span>,</span><br><span class="line">        <span class="number">1.04083e-15</span>,</span><br><span class="line">        <span class="number">2.60209e-16</span>,</span><br><span class="line">        <span class="number">6.50521e-17</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// BFS_GRAPH_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>bfs_graph.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bfs_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">BFS_graph::BFS_graph(QWidget* parent)</span><br><span class="line">    : QWidget(parent)&#123;</span><br><span class="line"></span><br><span class="line">    resize(<span class="number">650</span>,<span class="number">700</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BFS_graph::~BFS_graph()&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS_graph::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS_graph::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">BFS_graph::paintEvent</span><span class="params">(QPaintEvent *)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定绘图设备</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抗锯齿</span></span><br><span class="line">    painter.setRenderHint(QPainter::Antialiasing);</span><br><span class="line">    painter.setRenderHint(QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画笔</span></span><br><span class="line">    QPen penLine;</span><br><span class="line">    penLine.setWidth(<span class="number">1</span>); <span class="comment">//线宽</span></span><br><span class="line">    penLine.setColor(Qt::black); <span class="comment">//划线颜色</span></span><br><span class="line">    penLine.setStyle(Qt::SolidLine); <span class="comment">//线的类型，实线、虚线等</span></span><br><span class="line">    penLine.setCapStyle(Qt::FlatCap); <span class="comment">//线端点样式</span></span><br><span class="line">    penLine.setJoinStyle(Qt::BevelJoin); <span class="comment">//线的连接点样式</span></span><br><span class="line">    painter.setBrush(Qt::red); <span class="comment">// 填充颜色</span></span><br><span class="line">    painter.setPen(penLine);</span><br><span class="line"></span><br><span class="line">    <span class="function">QFont <span class="title">font</span><span class="params">(<span class="string">&quot;Fira Code&quot;</span>, <span class="number">13</span>, QFont::Normal, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    painter.setFont(font);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画布</span></span><br><span class="line">    painter.translate(<span class="number">300</span>,<span class="number">30</span>); <span class="comment">// 坐标原点初始化为 画布上边缘中点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(!q.empty()) q.pop(); <span class="comment">// 清空队列，防止重绘时出错</span></span><br><span class="line">    <span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line">    ini.steps=<span class="number">0</span>;</span><br><span class="line">    ini.px=ini.py=ini.fpx=ini.fpy=<span class="number">0</span>;</span><br><span class="line">    q.push(ini);</span><br><span class="line">    painter.drawEllipse(ini.px<span class="number">-4</span>,ini.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">    painter.drawText(ini.px<span class="number">-10</span>,ini.py<span class="number">-10</span>,<span class="string">&quot;Ini&quot;</span>);</span><br><span class="line">    <span class="keyword">while</span>(!q.empty())&#123; <span class="comment">// Loop until queue is empty</span></span><br><span class="line">        state cur=q.front();</span><br><span class="line">        q.pop();</span><br><span class="line">        painter.drawLine(cur.px,cur.py,cur.fpx,cur.fpy); <span class="comment">// 画线</span></span><br><span class="line">        <span class="comment">//qDebug()&lt;&lt;cur.fpx&lt;&lt;cur.fpy&lt;&lt;cur.px&lt;&lt;cur.py&lt;&lt;Qt::endl;</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s,goal.s,<span class="keyword">sizeof</span>(goal.s)))&#123; <span class="comment">// Find!</span></span><br><span class="line">            painter.drawEllipse(cur.px<span class="number">-4</span>,cur.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">            painter.drawText(cur.px<span class="number">-15</span>,cur.py+<span class="number">18</span>,<span class="string">&quot;Goal&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">            <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                <span class="comment">// Construct the new state after move</span></span><br><span class="line">                state next;</span><br><span class="line">                <span class="built_in">memcpy</span>(next.s,cur.s,<span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                next.pos=d[cur.pos][i];</span><br><span class="line">                <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                <span class="comment">// 设置 next 坐标</span></span><br><span class="line">                next.px=cur.px-(<span class="number">3.0</span>-i*<span class="number">2</span>)*w[next.steps];</span><br><span class="line">                next.py=cur.py+h;</span><br><span class="line">                next.fpx=cur.px;</span><br><span class="line">                next.fpy=cur.py;</span><br><span class="line">                <span class="comment">//qDebug()&lt;&lt;next.px&lt;&lt;next.py&lt;&lt;Qt::endl;</span></span><br><span class="line">                <span class="comment">// Encode new state</span></span><br><span class="line">                <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                <span class="keyword">if</span>(!vis.is_visited(code))&#123; <span class="comment">// If the new state is unvisited</span></span><br><span class="line">                    vis.visit(code); <span class="comment">// Mark it as visited</span></span><br><span class="line">                    q.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>dfs_graph.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> DFS_graph_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DFS_graph_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DFS_graph</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘图部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">DFS_graph</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~DFS_graph();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主算法部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">        <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">        <span class="keyword">int</span> prepos;</span><br><span class="line">        <span class="keyword">double</span> px,py;</span><br><span class="line">        <span class="keyword">double</span> fpx,fpy;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;state&gt; st;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> h=<span class="number">20</span>; <span class="comment">// 每层高</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> max_depth=<span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> w[<span class="number">32</span>]=&#123; <span class="comment">// 第 i 层两节点间宽度的一半</span></span><br><span class="line">        <span class="number">300</span>,</span><br><span class="line">        <span class="number">75</span>,</span><br><span class="line">        <span class="number">18.75</span>,</span><br><span class="line">        <span class="number">4.6875</span>,</span><br><span class="line">        <span class="number">1.17188</span>,</span><br><span class="line">        <span class="number">0.292969</span>,</span><br><span class="line">        <span class="number">0.0732422</span>,</span><br><span class="line">        <span class="number">0.0183105</span>,</span><br><span class="line">        <span class="number">0.00457764</span>,</span><br><span class="line">        <span class="number">0.00114441</span>,</span><br><span class="line">        <span class="number">0.000286102</span>,</span><br><span class="line">        <span class="number">7.15256e-05</span>,</span><br><span class="line">        <span class="number">1.78814e-05</span>,</span><br><span class="line">        <span class="number">4.47035e-06</span>,</span><br><span class="line">        <span class="number">1.11759e-06</span>,</span><br><span class="line">        <span class="number">2.79397e-07</span>,</span><br><span class="line">        <span class="number">6.98492e-08</span>,</span><br><span class="line">        <span class="number">1.74623e-08</span>,</span><br><span class="line">        <span class="number">4.36557e-09</span>,</span><br><span class="line">        <span class="number">1.09139e-09</span>,</span><br><span class="line">        <span class="number">2.72848e-10</span>,</span><br><span class="line">        <span class="number">6.82121e-11</span>,</span><br><span class="line">        <span class="number">1.7053e-11</span>,</span><br><span class="line">        <span class="number">4.26326e-12</span>,</span><br><span class="line">        <span class="number">1.06581e-12</span>,</span><br><span class="line">        <span class="number">2.66454e-13</span>,</span><br><span class="line">        <span class="number">6.66134e-14</span>,</span><br><span class="line">        <span class="number">1.66533e-14</span>,</span><br><span class="line">        <span class="number">4.16334e-15</span>,</span><br><span class="line">        <span class="number">1.04083e-15</span>,</span><br><span class="line">        <span class="number">2.60209e-16</span>,</span><br><span class="line">        <span class="number">6.50521e-17</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// DFS_graph_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>dfs_graph.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;dfs_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">DFS_graph::DFS_graph(QWidget* parent)</span><br><span class="line">    : QWidget(parent)&#123;</span><br><span class="line">    setWindowTitle(<span class="string">&quot;Advanced Analyse Tools&quot;</span>);</span><br><span class="line">    resize(<span class="number">650</span>,<span class="number">700</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DFS_graph::~DFS_graph()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS_graph::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DFS_graph::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS_graph::paintEvent</span><span class="params">(QPaintEvent *)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定绘图设备</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抗锯齿</span></span><br><span class="line">    painter.setRenderHint(QPainter::Antialiasing);</span><br><span class="line">    painter.setRenderHint(QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画笔</span></span><br><span class="line">    QPen penLine;</span><br><span class="line">    penLine.setWidth(<span class="number">1</span>); <span class="comment">//线宽</span></span><br><span class="line">    penLine.setColor(Qt::black); <span class="comment">//划线颜色</span></span><br><span class="line">    penLine.setStyle(Qt::SolidLine); <span class="comment">//线的类型，实线、虚线等</span></span><br><span class="line">    penLine.setCapStyle(Qt::FlatCap); <span class="comment">//线端点样式</span></span><br><span class="line">    penLine.setJoinStyle(Qt::BevelJoin); <span class="comment">//线的连接点样式</span></span><br><span class="line">    painter.setBrush(Qt::red); <span class="comment">// 填充颜色</span></span><br><span class="line">    painter.setPen(penLine);</span><br><span class="line"></span><br><span class="line">    <span class="function">QFont <span class="title">font</span><span class="params">(<span class="string">&quot;Fira Code&quot;</span>, <span class="number">13</span>, QFont::Normal, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    painter.setFont(font);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画布</span></span><br><span class="line">    painter.translate(<span class="number">300</span>,<span class="number">30</span>); <span class="comment">// 坐标原点初始化为 画布上边缘中点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!st.empty()) st.pop();</span><br><span class="line">        ini.steps=<span class="number">0</span>;</span><br><span class="line">        ini.prepos=<span class="number">-1</span>;</span><br><span class="line">        ini.px=ini.py=ini.fpx=ini.fpy=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//qDebug()&lt;&lt;ini.pos&lt;&lt;Qt::endl;</span></span><br><span class="line"></span><br><span class="line">        painter.drawEllipse(ini.px<span class="number">-4</span>,ini.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">        painter.drawText(ini.px<span class="number">-10</span>,ini.py<span class="number">-10</span>,<span class="string">&quot;Ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        st.push(ini);</span><br><span class="line">        <span class="keyword">while</span>(!st.empty())&#123;</span><br><span class="line">            state cur=st.top();</span><br><span class="line">            st.pop();</span><br><span class="line">            painter.drawLine(cur.px,cur.py,cur.fpx,cur.fpy); <span class="comment">//画线</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s, goal.s, <span class="keyword">sizeof</span>(goal.s)))&#123;</span><br><span class="line">                painter.drawEllipse(cur.px<span class="number">-4</span>,cur.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">                painter.drawText(cur.px<span class="number">-15</span>,cur.py+<span class="number">18</span>,<span class="string">&quot;Goal&quot;</span>);</span><br><span class="line">                <span class="comment">//qDebug()&lt;&lt;cur.px&lt;&lt;cur.py&lt;&lt;cur.steps;</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cur.steps&gt;max_depth) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">3</span>;i&gt;=<span class="number">0</span>;i--)&#123; <span class="comment">// 保持 UDLR 的搜索顺序</span></span><br><span class="line">                <span class="keyword">if</span>(d[cur.pos][i]==cur.prepos) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(~d[cur.pos][i])&#123;</span><br><span class="line">                    state next;</span><br><span class="line">                    <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                    next.pos=d[cur.pos][i];</span><br><span class="line">                    <span class="built_in">std</span>::swap(next.s[next.pos], next.s[cur.pos]);</span><br><span class="line">                    next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                    next.prepos=cur.pos;</span><br><span class="line">                    <span class="comment">// 设置 next 坐标</span></span><br><span class="line">                    next.px=cur.px-(<span class="number">3.0</span>-i*<span class="number">2</span>)*w[next.steps];</span><br><span class="line">                    next.py=cur.py+h;</span><br><span class="line">                    next.fpx=cur.px;</span><br><span class="line">                    next.fpy=cur.py;</span><br><span class="line">                    st.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>iddfs_graph.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> IDDFS_graph_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IDDFS_graph_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IDDFS_graph</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘图部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">IDDFS_graph</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~IDDFS_graph();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主算法部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">        <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">        <span class="keyword">int</span> prepos;</span><br><span class="line">        <span class="keyword">double</span> px,py;</span><br><span class="line">        <span class="keyword">double</span> fpx,fpy;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;state&gt; st;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> h=<span class="number">20</span>; <span class="comment">// 每层高</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> max_depth=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> w[<span class="number">32</span>]=&#123; <span class="comment">// 第 i 层两节点间宽度的一半</span></span><br><span class="line">        <span class="number">300</span>,</span><br><span class="line">        <span class="number">75</span>,</span><br><span class="line">        <span class="number">18.75</span>,</span><br><span class="line">        <span class="number">4.6875</span>,</span><br><span class="line">        <span class="number">1.17188</span>,</span><br><span class="line">        <span class="number">0.292969</span>,</span><br><span class="line">        <span class="number">0.0732422</span>,</span><br><span class="line">        <span class="number">0.0183105</span>,</span><br><span class="line">        <span class="number">0.00457764</span>,</span><br><span class="line">        <span class="number">0.00114441</span>,</span><br><span class="line">        <span class="number">0.000286102</span>,</span><br><span class="line">        <span class="number">7.15256e-05</span>,</span><br><span class="line">        <span class="number">1.78814e-05</span>,</span><br><span class="line">        <span class="number">4.47035e-06</span>,</span><br><span class="line">        <span class="number">1.11759e-06</span>,</span><br><span class="line">        <span class="number">2.79397e-07</span>,</span><br><span class="line">        <span class="number">6.98492e-08</span>,</span><br><span class="line">        <span class="number">1.74623e-08</span>,</span><br><span class="line">        <span class="number">4.36557e-09</span>,</span><br><span class="line">        <span class="number">1.09139e-09</span>,</span><br><span class="line">        <span class="number">2.72848e-10</span>,</span><br><span class="line">        <span class="number">6.82121e-11</span>,</span><br><span class="line">        <span class="number">1.7053e-11</span>,</span><br><span class="line">        <span class="number">4.26326e-12</span>,</span><br><span class="line">        <span class="number">1.06581e-12</span>,</span><br><span class="line">        <span class="number">2.66454e-13</span>,</span><br><span class="line">        <span class="number">6.66134e-14</span>,</span><br><span class="line">        <span class="number">1.66533e-14</span>,</span><br><span class="line">        <span class="number">4.16334e-15</span>,</span><br><span class="line">        <span class="number">1.04083e-15</span>,</span><br><span class="line">        <span class="number">2.60209e-16</span>,</span><br><span class="line">        <span class="number">6.50521e-17</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// IDDFS_graph_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>iddfs_graph.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;IDDFS_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">IDDFS_graph::IDDFS_graph(QWidget* parent)</span><br><span class="line">    : QWidget(parent)&#123;</span><br><span class="line">    setWindowTitle(<span class="string">&quot;Advanced Analyse Tools&quot;</span>);</span><br><span class="line">    resize(<span class="number">650</span>,<span class="number">700</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IDDFS_graph::~IDDFS_graph()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDDFS_graph::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IDDFS_graph::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IDDFS_graph::paintEvent</span><span class="params">(QPaintEvent *)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定绘图设备</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抗锯齿</span></span><br><span class="line">    painter.setRenderHint(QPainter::Antialiasing);</span><br><span class="line">    painter.setRenderHint(QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画笔</span></span><br><span class="line">    QPen penLine;</span><br><span class="line">    penLine.setWidth(<span class="number">1</span>); <span class="comment">//线宽</span></span><br><span class="line">    penLine.setColor(Qt::black); <span class="comment">//划线颜色</span></span><br><span class="line">    penLine.setStyle(Qt::SolidLine); <span class="comment">//线的类型，实线、虚线等</span></span><br><span class="line">    penLine.setCapStyle(Qt::FlatCap); <span class="comment">//线端点样式</span></span><br><span class="line">    penLine.setJoinStyle(Qt::BevelJoin); <span class="comment">//线的连接点样式</span></span><br><span class="line">    painter.setBrush(Qt::red); <span class="comment">// 填充颜色</span></span><br><span class="line">    painter.setPen(penLine);</span><br><span class="line"></span><br><span class="line">    <span class="function">QFont <span class="title">font</span><span class="params">(<span class="string">&quot;Fira Code&quot;</span>, <span class="number">13</span>, QFont::Normal, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    painter.setFont(font);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画布</span></span><br><span class="line">    painter.translate(<span class="number">300</span>,<span class="number">30</span>); <span class="comment">// 坐标原点初始化为 画布上边缘中点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!st.empty()) st.pop();</span><br><span class="line">        ini.steps=<span class="number">0</span>;</span><br><span class="line">        ini.prepos=<span class="number">-1</span>;</span><br><span class="line">        ini.px=ini.py=ini.fpx=ini.fpy=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//qDebug()&lt;&lt;ini.pos&lt;&lt;Qt::endl;</span></span><br><span class="line"></span><br><span class="line">        painter.drawEllipse(ini.px<span class="number">-4</span>,ini.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">        painter.drawText(ini.px<span class="number">-10</span>,ini.py<span class="number">-10</span>,<span class="string">&quot;Ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        FLAG: st.push(ini);</span><br><span class="line">        <span class="keyword">while</span>(!st.empty())&#123;</span><br><span class="line">            state cur=st.top();</span><br><span class="line">            st.pop();</span><br><span class="line">            painter.drawLine(cur.px,cur.py,cur.fpx,cur.fpy); <span class="comment">//画线</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="built_in">memcmp</span>(cur.s, goal.s, <span class="keyword">sizeof</span>(goal.s)))&#123;</span><br><span class="line">                painter.drawEllipse(cur.px<span class="number">-4</span>,cur.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">                painter.drawText(cur.px<span class="number">-15</span>,cur.py+<span class="number">18</span>,<span class="string">&quot;Goal&quot;</span>);</span><br><span class="line">                <span class="comment">//qDebug()&lt;&lt;cur.px&lt;&lt;cur.py&lt;&lt;cur.steps;</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(cur.steps&gt;max_depth) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">3</span>;i&gt;=<span class="number">0</span>;i--)&#123; <span class="comment">// 保持 UDLR 的搜索顺序</span></span><br><span class="line">                <span class="keyword">if</span>(d[cur.pos][i]==cur.prepos) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(~d[cur.pos][i])&#123;</span><br><span class="line">                    state next;</span><br><span class="line">                    <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                    next.pos=d[cur.pos][i];</span><br><span class="line">                    <span class="built_in">std</span>::swap(next.s[next.pos], next.s[cur.pos]);</span><br><span class="line">                    next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                    next.prepos=cur.pos;</span><br><span class="line">                    <span class="comment">// 设置 next 坐标</span></span><br><span class="line">                    next.px=cur.px-(<span class="number">3.0</span>-i*<span class="number">2</span>)*w[next.steps];</span><br><span class="line">                    next.py=cur.py+h;</span><br><span class="line">                    next.fpx=cur.px;</span><br><span class="line">                    next.fpy=cur.py;</span><br><span class="line">                    st.push(next);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        max_depth++;</span><br><span class="line">        <span class="keyword">goto</span> FLAG;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>a_star_graph.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> A_STAR_GRAPH_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> A_STAR_GRAPH_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> d[<span class="number">9</span>][<span class="number">4</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>];</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A_star_graph</span> :</span> <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘图部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">A_star_graph</span><span class="params">(QWidget* parent = <span class="number">0</span>)</span></span>;</span><br><span class="line">    ~A_star_graph();</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主算法部分</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(<span class="keyword">const</span> QString &amp;, <span class="keyword">const</span> QString &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">// 数据成员</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> s[<span class="number">9</span>]; <span class="comment">// 0 represents Space</span></span><br><span class="line">        <span class="keyword">int</span> pos; <span class="comment">// Position of space</span></span><br><span class="line">        <span class="keyword">int</span> steps; <span class="comment">// Steps to reach current state</span></span><br><span class="line">        <span class="keyword">int</span> h; <span class="comment">// Heuristic function</span></span><br><span class="line">        <span class="keyword">int</span> f;</span><br><span class="line">        <span class="keyword">double</span> px,py;</span><br><span class="line">        <span class="keyword">double</span> fpx,fpy;</span><br><span class="line">    &#125;ini,goal;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">priority_queue</span>&lt;state&gt; q;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> h=<span class="number">20</span>; <span class="comment">// 每层高</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">double</span> w[<span class="number">32</span>]=&#123; <span class="comment">// 第 i 层两节点间宽度的一半</span></span><br><span class="line">        <span class="number">300</span>,</span><br><span class="line">        <span class="number">75</span>,</span><br><span class="line">        <span class="number">18.75</span>,</span><br><span class="line">        <span class="number">4.6875</span>,</span><br><span class="line">        <span class="number">1.17188</span>,</span><br><span class="line">        <span class="number">0.292969</span>,</span><br><span class="line">        <span class="number">0.0732422</span>,</span><br><span class="line">        <span class="number">0.0183105</span>,</span><br><span class="line">        <span class="number">0.00457764</span>,</span><br><span class="line">        <span class="number">0.00114441</span>,</span><br><span class="line">        <span class="number">0.000286102</span>,</span><br><span class="line">        <span class="number">7.15256e-05</span>,</span><br><span class="line">        <span class="number">1.78814e-05</span>,</span><br><span class="line">        <span class="number">4.47035e-06</span>,</span><br><span class="line">        <span class="number">1.11759e-06</span>,</span><br><span class="line">        <span class="number">2.79397e-07</span>,</span><br><span class="line">        <span class="number">6.98492e-08</span>,</span><br><span class="line">        <span class="number">1.74623e-08</span>,</span><br><span class="line">        <span class="number">4.36557e-09</span>,</span><br><span class="line">        <span class="number">1.09139e-09</span>,</span><br><span class="line">        <span class="number">2.72848e-10</span>,</span><br><span class="line">        <span class="number">6.82121e-11</span>,</span><br><span class="line">        <span class="number">1.7053e-11</span>,</span><br><span class="line">        <span class="number">4.26326e-12</span>,</span><br><span class="line">        <span class="number">1.06581e-12</span>,</span><br><span class="line">        <span class="number">2.66454e-13</span>,</span><br><span class="line">        <span class="number">6.66134e-14</span>,</span><br><span class="line">        <span class="number">1.66533e-14</span>,</span><br><span class="line">        <span class="number">4.16334e-15</span>,</span><br><span class="line">        <span class="number">1.04083e-15</span>,</span><br><span class="line">        <span class="number">2.60209e-16</span>,</span><br><span class="line">        <span class="number">6.50521e-17</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具函数</span></span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> A_star_graph::state &amp;, <span class="keyword">const</span> A_star_graph::state &amp;);</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp;,<span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp;, <span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// A_STAR_GRAPH_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>a_star_graph.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;a_star_graph.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QPainter&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"></span><br><span class="line">A_star_graph::A_star_graph(QWidget* parent)</span><br><span class="line">    : QWidget(parent)&#123;</span><br><span class="line">    setWindowTitle(<span class="string">&quot;Advanced Analyse Tools&quot;</span>);</span><br><span class="line">    resize(<span class="number">650</span>,<span class="number">700</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A_star_graph::~A_star_graph()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> A_star_graph::state &amp; x, <span class="keyword">const</span> A_star_graph::state &amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">A_star_graph::set</span><span class="params">(<span class="keyword">const</span> QString &amp; input1, <span class="keyword">const</span> QString &amp; input2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        ini.s[i]=<span class="keyword">int</span>(input1[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        goal.s[i]=<span class="keyword">int</span>(input2[i].toLatin1()-<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!ini.s[i]) ini.pos=i;</span><br><span class="line">        <span class="keyword">if</span>(!goal.s[i]) goal.pos=i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">A_star_graph::calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!cur.s[i]) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">A_star_graph::is_solvable</span><span class="params">(<span class="keyword">const</span> state &amp; ini, <span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n1=<span class="number">0</span>,n2=<span class="number">0</span>; <span class="comment">// Inverse number</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(ini.s[i]&gt;ini.s[j] &amp;&amp; ini.s[j]!=<span class="number">0</span>) n1++;</span><br><span class="line">            <span class="keyword">if</span>(goal.s[i]&gt;goal.s[j] &amp;&amp; goal.s[j]!=<span class="number">0</span>) n2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((n1&amp;<span class="number">1</span>)!=(n2&amp;<span class="number">1</span>)) <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// Same parity =&gt; Solvable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// Different parity =&gt; Insolvable</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">A_star_graph::paintEvent</span><span class="params">(QPaintEvent *)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指定绘图设备</span></span><br><span class="line">    <span class="function">QPainter <span class="title">painter</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抗锯齿</span></span><br><span class="line">    painter.setRenderHint(QPainter::Antialiasing);</span><br><span class="line">    painter.setRenderHint(QPainter::TextAntialiasing);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画笔</span></span><br><span class="line">    QPen penLine;</span><br><span class="line">    penLine.setWidth(<span class="number">1</span>); <span class="comment">//线宽</span></span><br><span class="line">    penLine.setColor(Qt::black); <span class="comment">//划线颜色</span></span><br><span class="line">    penLine.setStyle(Qt::SolidLine); <span class="comment">//线的类型，实线、虚线等</span></span><br><span class="line">    penLine.setCapStyle(Qt::FlatCap); <span class="comment">//线端点样式</span></span><br><span class="line">    penLine.setJoinStyle(Qt::BevelJoin); <span class="comment">//线的连接点样式</span></span><br><span class="line">    painter.setBrush(Qt::red); <span class="comment">// 填充颜色</span></span><br><span class="line">    painter.setPen(penLine);</span><br><span class="line"></span><br><span class="line">    <span class="function">QFont <span class="title">font</span><span class="params">(<span class="string">&quot;Fira Code&quot;</span>, <span class="number">13</span>, QFont::Normal, <span class="literal">false</span>)</span></span>;</span><br><span class="line">    painter.setFont(font);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置画布</span></span><br><span class="line">    painter.translate(<span class="number">300</span>,<span class="number">30</span>); <span class="comment">// 坐标原点初始化为 画布上边缘中点</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(is_solvable(ini,goal))&#123;</span><br><span class="line">        <span class="keyword">while</span>(!q.empty()) q.pop();</span><br><span class="line">        <span class="function">bitmap <span class="title">vis</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line">        ini.steps=<span class="number">0</span>;</span><br><span class="line">        ini.h=calc_manhattan(ini,goal);</span><br><span class="line">        ini.f=ini.steps+ini.h;</span><br><span class="line">        ini.px=ini.py=ini.fpx=ini.fpy=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        painter.drawEllipse(ini.px<span class="number">-4</span>,ini.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">        painter.drawText(ini.px<span class="number">-10</span>,ini.py<span class="number">-10</span>,<span class="string">&quot;Ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        q.push(ini);</span><br><span class="line">        <span class="keyword">while</span>(!q.empty())&#123;</span><br><span class="line">            state cur=q.top();</span><br><span class="line">            q.pop();</span><br><span class="line">            painter.drawLine(cur.px,cur.py,cur.fpx,cur.fpy); <span class="comment">// 画线</span></span><br><span class="line">            <span class="keyword">if</span>(!cur.h)&#123;</span><br><span class="line">                painter.drawEllipse(cur.px<span class="number">-4</span>,cur.py<span class="number">-4</span>,<span class="number">8</span>,<span class="number">8</span>);</span><br><span class="line">                painter.drawText(cur.px<span class="number">-15</span>,cur.py+<span class="number">18</span>,<span class="string">&quot;Goal&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123; <span class="comment">// try 4 direction</span></span><br><span class="line">                <span class="keyword">if</span>(~d[cur.pos][i])&#123; <span class="comment">// If current move is accepted</span></span><br><span class="line">                    <span class="comment">// Construct the new state after move</span></span><br><span class="line">                    state next;</span><br><span class="line">                    <span class="built_in">memcpy</span>(next.s, cur.s, <span class="keyword">sizeof</span>(cur.s));</span><br><span class="line">                    next.pos=d[cur.pos][i];</span><br><span class="line">                    <span class="built_in">std</span>::swap(next.s[cur.pos],next.s[next.pos]);</span><br><span class="line">                    next.steps=cur.steps+<span class="number">1</span>;</span><br><span class="line">                    next.h=calc_manhattan(next,goal);</span><br><span class="line">                    next.f=next.steps+next.h;</span><br><span class="line">                    <span class="comment">// 设置 next 坐标</span></span><br><span class="line">                    next.px=cur.px-(<span class="number">3.0</span>-i*<span class="number">2</span>)*w[next.steps];</span><br><span class="line">                    next.py=cur.py+h;</span><br><span class="line">                    next.fpx=cur.px;</span><br><span class="line">                    next.fpy=cur.py;</span><br><span class="line">                    <span class="comment">//qDebug()&lt;&lt;next.px&lt;&lt;&#x27; &#x27;&lt;&lt;next.py&lt;&lt;Qt::endl;</span></span><br><span class="line">                    <span class="keyword">int</span> code=encode(next.s);</span><br><span class="line">                    <span class="keyword">if</span>(!vis.is_visited(code))&#123;</span><br><span class="line">                        vis.visit(code);</span><br><span class="line">                        q.push(next);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>bitmap.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> BITMAP_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> BITMAP_H</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> fact[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap(): buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    bitmap(<span class="keyword">const</span> <span class="keyword">int</span> &amp; siz)&#123;</span><br><span class="line">        buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(siz/<span class="number">32</span>)]();</span><br><span class="line">    &#125;</span><br><span class="line">    ~bitmap()&#123;</span><br><span class="line">        <span class="keyword">delete</span> [] buf;</span><br><span class="line">        buf=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">undo_visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// BITMAP_H</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>bitmap.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;bitmap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    n is in the j-th bit of the i-th int</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">    |  1st int |  2nd int |  3rd int |          | i-th int |</span></span><br><span class="line"><span class="comment">    +----------+----------+----------+----   ---+----------+----------</span></span><br><span class="line"><span class="comment">                                                       ↑</span></span><br><span class="line"><span class="comment">                                                    j-th bit</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>; <span class="comment">// Equivalent to j=n%32;</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To change the j-th bit from 0 to 1,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th bit is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then OR the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010</span></span><br><span class="line"><span class="comment">            OR  1100 0010</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bitmap::is_visited</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       To check the j-th bit,</span></span><br><span class="line"><span class="comment">       we need to construct a number whose j-th is 1 and the rest bits are 0 (1&lt;&lt;j),</span></span><br><span class="line"><span class="comment">       then AND the original number with the constructed number.</span></span><br><span class="line"><span class="comment">       e.g      1100 0000			        1100 0000</span></span><br><span class="line"><span class="comment">                0000 0010			        0100 0000</span></span><br><span class="line"><span class="comment">           AND  0000 0000 (false)      AND  0100 0000 (true)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::undo_visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    buf[i]|=~(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><figcaption><span>eight_puzzle.ui</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;ui version&#x3D;&quot;4.0&quot;&gt;</span><br><span class="line"> &lt;class&gt;eight_puzzle&lt;&#x2F;class&gt;</span><br><span class="line"> &lt;widget class&#x3D;&quot;QWidget&quot; name&#x3D;&quot;eight_puzzle&quot;&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;geometry&quot;&gt;</span><br><span class="line">   &lt;rect&gt;</span><br><span class="line">    &lt;x&gt;0&lt;&#x2F;x&gt;</span><br><span class="line">    &lt;y&gt;0&lt;&#x2F;y&gt;</span><br><span class="line">    &lt;width&gt;800&lt;&#x2F;width&gt;</span><br><span class="line">    &lt;height&gt;600&lt;&#x2F;height&gt;</span><br><span class="line">   &lt;&#x2F;rect&gt;</span><br><span class="line">  &lt;&#x2F;property&gt;</span><br><span class="line">  &lt;property name&#x3D;&quot;windowTitle&quot;&gt;</span><br><span class="line">   &lt;string&gt;eight_puzzle&lt;&#x2F;string&gt;</span><br><span class="line">  &lt;&#x2F;property&gt;</span><br><span class="line"> &lt;&#x2F;widget&gt;</span><br><span class="line"> &lt;resources&#x2F;&gt;</span><br><span class="line"> &lt;connections&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;ui&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><figcaption><span>A_star_fhq_treap.cpp</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;ctime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    T val;</span><br><span class="line">    <span class="keyword">int</span> rnd,siz;</span><br><span class="line">    node* lc;</span><br><span class="line">    node* rc;</span><br><span class="line">    node(T _val=<span class="number">0</span>)&#123;</span><br><span class="line">        val=_val;</span><br><span class="line">        rnd=rand()&amp;<span class="number">32767</span>;</span><br><span class="line">        siz=<span class="number">1</span>;</span><br><span class="line">        lc=rc=<span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">update_siz</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fhq_treap</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    node&lt;T&gt;* root;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(node&lt;T&gt;*,node&lt;T&gt;*&amp;,node&lt;T&gt;*&amp;,<span class="keyword">const</span> T&amp;)</span></span>;</span><br><span class="line">    <span class="function">node&lt;T&gt;*&amp; <span class="title">merge</span><span class="params">(node&lt;T&gt;*&amp;,node&lt;T&gt;*&amp;)</span></span>;</span><br><span class="line">    <span class="function">node&lt;T&gt;* <span class="title">kth</span><span class="params">(node&lt;T&gt;*,<span class="keyword">const</span> <span class="keyword">int</span>&amp; k)</span></span>;</span><br><span class="line">    <span class="function">T* <span class="title">p_exist</span><span class="params">(node&lt;T&gt;*,<span class="keyword">const</span> T&amp; x)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    fhq_treap():root(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> T&amp;)</span></span>;</span><br><span class="line">    <span class="function">T* <span class="title">get_min_and_del</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T* <span class="title">exist</span><span class="params">(<span class="keyword">const</span> T&amp; x)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> s[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">int</span> f,g,h;</span><br><span class="line">    state* parent;</span><br><span class="line">    state&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> state&amp;);</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> state&amp;,<span class="keyword">const</span> state&amp;);</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> state&amp;,<span class="keyword">const</span> state&amp;);</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&lt;=(<span class="keyword">const</span> state&amp;,<span class="keyword">const</span> state&amp;);</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&gt;(<span class="keyword">const</span> state&amp;,<span class="keyword">const</span> state&amp;);</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">bool</span> <span class="keyword">operator</span>&gt;=(<span class="keyword">const</span> state&amp;,<span class="keyword">const</span> state&amp;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bitmap</span>&#123;</span> <span class="comment">// 位图</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span>* buf;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    bitmap();</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">bitmap</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    ~bitmap();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">visit</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">is_visited</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[]=&#123;<span class="number">-1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dy[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">state ini,goal;</span><br><span class="line"><span class="keyword">int</span> fact[<span class="number">9</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 曼哈顿距离表</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> manhattan[<span class="number">9</span>][<span class="number">9</span>]=&#123;</span><br><span class="line">        <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,</span><br><span class="line">        <span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(T&amp;,T&amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span>)</span></span>; <span class="comment">// 向上取整</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span>* p)</span></span>; <span class="comment">// 康拓展开</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp;,<span class="keyword">const</span> state &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">A_star</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化阶乘数组</span></span><br><span class="line">    fact[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">        fact[i]=i*fact[i<span class="number">-1</span>];</span><br><span class="line">    <span class="comment">// open 表</span></span><br><span class="line">    fhq_treap&lt;state&gt; open;</span><br><span class="line">    <span class="comment">// close 表</span></span><br><span class="line">    <span class="function">bitmap <span class="title">close</span><span class="params">(<span class="number">362880</span>)</span></span>;</span><br><span class="line">    <span class="comment">// 初始化初始状态的 f,g,h 值，父节点设为空</span></span><br><span class="line">    ini.h=calc_manhattan(ini,goal);</span><br><span class="line">    ini.g=<span class="number">0</span>;</span><br><span class="line">    ini.f=ini.h+ini.g;</span><br><span class="line">    ini.parent=<span class="literal">nullptr</span>;</span><br><span class="line">    <span class="comment">// 初始状态放入 open 表</span></span><br><span class="line">    open.insert(ini);</span><br><span class="line">    <span class="keyword">while</span>(!open.empty())&#123;</span><br><span class="line">        state* cur=open.get_min_and_del(); <span class="comment">// 取出 f 值最小的状态</span></span><br><span class="line">        close.visit(encode(cur-&gt;s)); <span class="comment">// 将取出的状态放入 close 表中</span></span><br><span class="line">        <span class="comment">// 找空格位置</span></span><br><span class="line">        <span class="keyword">int</span> p0;</span><br><span class="line">        <span class="keyword">for</span>(p0=<span class="number">0</span>;p0&lt;<span class="number">9</span>;p0++) <span class="keyword">if</span>(!cur-&gt;s[p0]) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">int</span> x=p0/<span class="number">3</span>,y=p0%<span class="number">3</span>;</span><br><span class="line">        <span class="comment">// 四种移动方式</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur-&gt;h==<span class="number">0</span>)&#123; <span class="comment">// h==0 说明找到了</span></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;cur-&gt;g&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="comment">// 根据 parent 回溯得到路径</span></span><br><span class="line">                <span class="keyword">for</span>(state* it=cur;it!=<span class="literal">nullptr</span>;it=it-&gt;parent)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)</span><br><span class="line">                        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;it-&gt;s[i]&lt;&lt;<span class="string">&#x27; &#x27;</span>;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 尝试移动</span></span><br><span class="line">            <span class="keyword">int</span> new_x=x+dx[i];</span><br><span class="line">            <span class="keyword">int</span> new_y=y+dy[i];</span><br><span class="line">            <span class="keyword">int</span> new_p0=new_x*<span class="number">3</span>+new_y;</span><br><span class="line">            <span class="keyword">if</span>(new_x&gt;=<span class="number">0</span> &amp;&amp; new_x&lt;<span class="number">3</span> &amp;&amp; new_y&gt;=<span class="number">0</span> &amp;&amp; new_y&lt;<span class="number">3</span>)&#123; <span class="comment">// 如果移动合法</span></span><br><span class="line">                 <span class="comment">// 创建移动后新状态</span></span><br><span class="line">                state* t=<span class="keyword">new</span> state;</span><br><span class="line">                *t=*cur;</span><br><span class="line">                swap(t-&gt;s[new_p0],t-&gt;s[p0]);</span><br><span class="line">                t-&gt;h=calc_manhattan(*t,goal);</span><br><span class="line">                t-&gt;g=cur-&gt;g+<span class="number">1</span>;</span><br><span class="line">                t-&gt;f=t-&gt;g+t-&gt;h;</span><br><span class="line">                t-&gt;parent=cur;</span><br><span class="line">                <span class="keyword">if</span>(!close.is_visited(encode(t-&gt;s)))&#123; <span class="comment">// 移动后状态不在 close 表中</span></span><br><span class="line">                    state* p=open.exist(*t); <span class="comment">// 在 open 表中找这个状态</span></span><br><span class="line">                    <span class="keyword">if</span>(p==<span class="literal">nullptr</span>)&#123; <span class="comment">//  open 表中没找到，则插入这个状态</span></span><br><span class="line">                        open.insert(*t);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(*p&lt;*t)&#123; <span class="comment">//  open 表中找到了，比较 f 值大小</span></span><br><span class="line">                        *t=*p; <span class="comment">// open 表中只留 f 小的那个</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.in&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="built_in">stdin</span>);</span><br><span class="line">    freopen(<span class="string">&quot;Test.out&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++) <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;ini.s[i];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++) <span class="built_in">std</span>::<span class="built_in">cin</span>&gt;&gt;goal.s[i];</span><br><span class="line">    A_star();</span><br><span class="line">    fclose(<span class="built_in">stdin</span>);</span><br><span class="line">    fclose(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">state&amp; state::<span class="keyword">operator</span>=(<span class="keyword">const</span> state&amp; x)&#123;</span><br><span class="line">    f=x.f;</span><br><span class="line">    g=x.g;</span><br><span class="line">    h=x.h;</span><br><span class="line">    parent=x.parent;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;s[<span class="number">0</span>],&amp;x.s[<span class="number">0</span>],<span class="keyword">sizeof</span>(s));</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> state&amp; x,<span class="keyword">const</span> state&amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="built_in">memcmp</span>(x.s,y.s,<span class="keyword">sizeof</span>(x.s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;(<span class="keyword">const</span> state&amp; x,<span class="keyword">const</span> state&amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&lt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&lt;=(<span class="keyword">const</span> state&amp; x,<span class="keyword">const</span> state&amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&lt;=y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&gt;(<span class="keyword">const</span> state&amp; x,<span class="keyword">const</span> state&amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&gt;y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>&gt;=(<span class="keyword">const</span> state&amp; x,<span class="keyword">const</span> state&amp; y)&#123;</span><br><span class="line">    <span class="keyword">return</span> x.f&gt;=y.f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ceil</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x&gt;(<span class="keyword">int</span>)x?(<span class="keyword">int</span>)x+<span class="number">1</span>:(<span class="keyword">int</span>)x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(T&amp; x,T&amp; y)</span></span>&#123;</span><br><span class="line">    T tmp=x;</span><br><span class="line">    x=y;</span><br><span class="line">    y=tmp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">encode</span><span class="params">(<span class="keyword">int</span> *p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> code=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=i+<span class="number">1</span>;j&lt;<span class="number">9</span>;j++)</span><br><span class="line">            <span class="keyword">if</span>(p[j]&lt;p[i])  cnt++;</span><br><span class="line">        code+=fact[<span class="number">8</span>-i]*cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br><span class="line">bitmap::bitmap():buf(<span class="literal">nullptr</span>)&#123;&#125;</span><br><span class="line">bitmap::bitmap(<span class="keyword">int</span> upper_bound)&#123;</span><br><span class="line">    buf=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">ceil</span>(upper_bound/<span class="number">32</span>)];</span><br><span class="line">&#125;</span><br><span class="line">bitmap::~bitmap()&#123;</span><br><span class="line">    <span class="keyword">delete</span> [] buf;</span><br><span class="line">    buf=<span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bitmap::visit</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="comment">// n 对应的 bit 为第 i 个 int 的第 j 位</span></span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="comment">// a%b==a&amp;(b-1) b 为 2 的幂</span></span><br><span class="line">    buf[i]|=(<span class="number">1</span>&lt;&lt;j);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bitmap::is_visited</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=n/<span class="number">32</span>;</span><br><span class="line">    <span class="keyword">int</span> j=n&amp;<span class="number">31</span>;</span><br><span class="line">    <span class="keyword">return</span> ((buf[i]&amp;(<span class="number">1</span>&lt;&lt;j))!=<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> node&lt;T&gt;::update_siz()&#123;</span><br><span class="line">    siz=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(lc!=<span class="literal">nullptr</span>) siz+=lc-&gt;siz;</span><br><span class="line">    <span class="keyword">if</span>(rc!=<span class="literal">nullptr</span>) siz+=rc-&gt;siz;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> fhq_treap&lt;T&gt;::split(node&lt;T&gt;* root,node&lt;T&gt;*&amp; a,node&lt;T&gt;*&amp;b,<span class="keyword">const</span> T&amp; pivot)&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>) <span class="keyword">return</span> a=b=<span class="literal">nullptr</span>,<span class="keyword">void</span>();</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;val&lt;=pivot)&#123;</span><br><span class="line">        a=root;</span><br><span class="line">        split(root-&gt;rc,a-&gt;rc,b,pivot);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        b=root;</span><br><span class="line">        split(root-&gt;lc,a,b-&gt;lc,pivot);</span><br><span class="line">    &#125;</span><br><span class="line">    root-&gt;update_siz();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">node&lt;T&gt;*&amp; fhq_treap&lt;T&gt;::merge(node&lt;T&gt;*&amp; a,node&lt;T&gt;*&amp;b)&#123;</span><br><span class="line">    <span class="keyword">if</span>(a==<span class="literal">nullptr</span>) <span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">if</span>(b==<span class="literal">nullptr</span>) <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">if</span>(a-&gt;rnd&lt;=b-&gt;rnd)&#123;</span><br><span class="line">        a-&gt;rc=merge(a-&gt;rc,b);</span><br><span class="line">        a-&gt;update_siz();</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        b-&gt;lc=merge(a,b-&gt;lc);</span><br><span class="line">        b-&gt;update_siz();</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">node&lt;T&gt;* fhq_treap&lt;T&gt;::kth(node&lt;T&gt;* _root,<span class="keyword">const</span> <span class="keyword">int</span>&amp; k)&#123;</span><br><span class="line">    assert(_root!=<span class="literal">nullptr</span>); <span class="comment">// 断言</span></span><br><span class="line">    <span class="keyword">int</span> lc_siz=(_root-&gt;lc==<span class="literal">nullptr</span> ? <span class="number">0</span> : _root-&gt;lc-&gt;siz);</span><br><span class="line">    <span class="keyword">if</span>(lc_siz&gt;=k) <span class="keyword">return</span> kth(_root-&gt;lc,k);</span><br><span class="line">    <span class="keyword">if</span>(lc_siz+<span class="number">1</span>&lt;k) <span class="keyword">return</span> kth(_root-&gt;rc,k-lc_siz<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> _root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">void</span> fhq_treap&lt;T&gt;::insert(<span class="keyword">const</span> T&amp; _val)&#123;</span><br><span class="line">    node&lt;T&gt;* a=<span class="literal">nullptr</span>;</span><br><span class="line">    node&lt;T&gt;* b=<span class="literal">nullptr</span>;</span><br><span class="line">    node&lt;T&gt;* n=<span class="literal">nullptr</span>;</span><br><span class="line">    split(root,a,b,_val);</span><br><span class="line">    <span class="keyword">if</span>(a!=<span class="literal">nullptr</span> &amp;&amp; (n=kth(a,a-&gt;siz))-&gt;val==_val)&#123;</span><br><span class="line">        <span class="comment">// exist;</span></span><br><span class="line">        root=merge(a,b);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        n=<span class="keyword">new</span> node&lt;T&gt;(_val);</span><br><span class="line">        root=merge(merge(a,n),b);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T* fhq_treap&lt;T&gt;::get_min_and_del()&#123;</span><br><span class="line">    assert(root!=<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;lc==<span class="literal">nullptr</span>)&#123;</span><br><span class="line">        T* tmp=&amp;root-&gt;val;</span><br><span class="line">        root=root-&gt;rc;</span><br><span class="line">        <span class="keyword">return</span> tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    node&lt;T&gt;* it;</span><br><span class="line">    <span class="keyword">for</span>(it=root;it-&gt;lc-&gt;lc!=<span class="literal">nullptr</span>;it=it-&gt;lc)&#123;&#125;</span><br><span class="line">    T* tmp=&amp;it-&gt;lc-&gt;val;</span><br><span class="line">    it-&gt;lc=it-&gt;lc-&gt;rc;</span><br><span class="line">    <span class="keyword">return</span> tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T* fhq_treap&lt;T&gt;::p_exist(node&lt;T&gt;* root,<span class="keyword">const</span> T&amp; x)&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;val==x) <span class="keyword">return</span> &amp;root-&gt;val;</span><br><span class="line">    <span class="keyword">if</span>(root-&gt;val&lt;x) <span class="keyword">return</span> p_exist(root-&gt;rc,x);</span><br><span class="line">    <span class="keyword">return</span> p_exist(root-&gt;lc,x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">T* fhq_treap&lt;T&gt;::exist(<span class="keyword">const</span> T&amp; x)&#123;</span><br><span class="line">    <span class="keyword">return</span> p_exist(root,x);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">bool</span> fhq_treap&lt;T&gt;::empty()&#123;</span><br><span class="line">    <span class="keyword">return</span> root==<span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc_manhattan</span><span class="params">(<span class="keyword">const</span> state &amp; cur,<span class="keyword">const</span> state &amp; goal)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> dis=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">9</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.s[i]==goal.s[j])&#123;</span><br><span class="line">                dis+=manhattan[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dis;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%AE%97%E6%B3%95/" rel="tag"># 算法</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/01/02/iTerm2/" rel="prev" title="iTerm2">
                  <i class="fa fa-chevron-left"></i> iTerm2
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/01/05/multithreading/" rel="next" title="Python 多线程">
                  Python 多线程 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Stardust Crusader</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">112k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">1:42</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
<!-- require MetingJS-->
<script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script> 
<!--网易云-->
<div class="aplayer" 
    data-id="5444575757" 
    data-server="netease" 
    data-type="playlist" 
    data-fixed="true" 
    data-mini="true"
    data-autoplay="true" 
    data-list-folded="true"
    data-mutex="true"
    data-order="random" 
    data-loop="all"
    data-volume="0.4" 
    data-theme="rgb(15,15,15)" 
    date-preload="auto"
    data-list-max-height=500px
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  
<script src="/js/local-search.js"></script>






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = '//cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css">

<script>
NexT.utils.loadComments('.gitalk-container', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '019118d09f87c9992fae',
      clientSecret: 'b4d2650f53a338ed11ed4a38d914e929da97b11e',
      repo        : 'comments',
      owner       : 'Stardusten',
      admin       : ['Stardusten'],
      id          : 'ae4368682d76866750c4e1045f85a68d',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render(document.querySelector('.gitalk-container'));
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
